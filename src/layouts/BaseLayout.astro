---
import SettingsModal from '../components/SettingsModal.astro';
import FooterMain from '../components/footer/FooterMain.astro';

// Swiper Studio version - update this when you publish changes in Swiper Studio
const SWIPER_VERSION = '6';

export interface Props {
	title: string;
}

const { title } = Astro.props;
---

<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="description" content="MannyKnows - Professional AI-powered business solutions. Transform your business with intelligent automation, data-driven insights, and cutting-edge AI services." />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="generator" content={Astro.generator} />
		
		<!-- Security Headers -->
		<meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://static.cloudflareinsights.com https://meet.jit.si https://cdn.jsdelivr.net https://cdn.studio.swiperjs.com https://www.clarity.ms; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdn.jsdelivr.net https://cdn.studio.swiperjs.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https: blob:; connect-src 'self' https://api.openai.com https://api.resend.com https://static.cloudflareinsights.com https://meet.jit.si https://www.clarity.ms https://*.clarity.ms; frame-src 'self' https://meet.jit.si; media-src 'self' https: blob:;" />
		<meta http-equiv="X-Content-Type-Options" content="nosniff" />
		<meta http-equiv="Strict-Transport-Security" content="max-age=31536000; includeSubDomains" />
		<meta name="referrer" content="strict-origin-when-cross-origin" />
		
		<!-- Swiper Studio Slider -->
		<link href={`https://cdn.studio.swiperjs.com/coral-fanya-470.css?v=${SWIPER_VERSION}`} rel="stylesheet" />

		<!-- Microsoft Clarity Analytics -->
		<script>
			import Clarity from '@microsoft/clarity';
			Clarity.init('v0ixsac9id');
		</script>
		
		<!-- OPTIMIZED: Load pixel canvas only when needed -->
		<script>
			// Defer pixel canvas loading until user interaction or idle time
			let pixelCanvasLoaded = false;
			
			function loadPixelCanvas() {
				if (pixelCanvasLoaded) return;
				pixelCanvasLoaded = true;
				
				const script = document.createElement('script');
				script.type = 'module';
				script.src = '/pixel-canvas.js';
				document.head.appendChild(script);
			}
			
			// Load on user interaction or after page is idle
			const interactionEvents = ['scroll', 'mousemove', 'touchstart'];
			const loadOnInteraction = () => {
				loadPixelCanvas();
				interactionEvents.forEach(event => 
					document.removeEventListener(event, loadOnInteraction)
				);
			};
			
			interactionEvents.forEach(event => 
				document.addEventListener(event, loadOnInteraction, { 
					passive: true, 
					once: true 
				})
			);
			
			// Fallback: load after 10 seconds if no interaction
			setTimeout(loadPixelCanvas, 10000);
		</script>
		
		<title>{title}</title>
		
		<!-- CRITICAL: Theme initialization script - must run before body to prevent FOUC -->
		<script is:inline>
			// Initialize theme immediately to prevent flash of unstyled content
			(function() {
				function getInitialTheme() {
					try {
						// Check if user has explicitly set a preference
						const stored = localStorage.getItem('theme-dark');
						if (stored !== null) {
							return stored !== 'false';
						}
						
						// Default to dark mode by design (instead of system preference)
						return true;
					} catch (error) {
						// Handle localStorage errors (private browsing, etc.)
						// Default to dark mode by design
						return true;
					}
				}
				
				const isDark = getInitialTheme();
				document.documentElement.classList.toggle('dark', isDark);
				
				// Store the resolved preference for consistency
				try {
					if (localStorage.getItem('theme-dark') === null) {
						localStorage.setItem('theme-dark', isDark.toString());
					}
				} catch (error) {
					// Silently fail if localStorage is unavailable
				}
			})();
		</script>
	</head>
	<body>
		<!-- Settings Modal -->
		<SettingsModal />
		
		<slot />

		<FooterMain />

		<!-- Swiper Studio Script -->
		<script src={`https://cdn.studio.swiperjs.com/coral-fanya-470.js?v=${SWIPER_VERSION}`} type="module"></script>
	</body>
</html>

<style is:global>
	:root {
		/* Native System Font Stack */
		--bs-body-font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
		--bs-font-family-heading: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
		--bs-body-font-size: 1rem;
		--bs-body-font-weight: 400;
		--bs-body-line-height: 1.1666666667;
		--bs-body-color: #ffffff;
		--bs-body-bg: #1b1c1e;
		--bs-body-text-align: left;
		
		/* Apple-style Typography Variables - Light Theme */
		--sk-body-text-color: rgb(29,29,31);
		--sk-headline-text-color: rgb(29,29,31);
		--sk-body-background-color: rgb(255,255,255);
		--sk-body-font-stack: text;
		--sk-focus-color: #0071e3;
		--sk-focus-color-alt: rgb(0,0,0);
		--sk-focus-offset: 1px;
		
		/* Apple-style Grays - Light Theme */
		--sk-glyph-gray: rgb(29,29,31);
		--sk-glyph-gray-secondary: rgb(110,110,115);
		--sk-glyph-gray-tertiary: rgb(134,134,139);
		--sk-fill-secondary: rgb(250,250,252);
		--sk-fill-tertiary: rgb(245,245,247);
		--sk-fill-gray-quaternary: rgb(232,232,237);
		
		/* Border Colors - Light Theme */
		--border-light: rgba(0, 0, 0, 0.1);
		--border-light-hover: rgba(0, 0, 0, 0.2);
		--border-dark: rgba(255, 255, 255, 0.1);
		--border-dark-hover: rgba(255, 255, 255, 0.2);
		
		/* Text Colors - Light Theme */
		--text-light-primary: rgb(29, 29, 31);
		--text-dark-primary: rgba(255, 255, 255, 0.95);
		
		/* Typography Enhancement */
		letter-spacing: .009em;
		font-synthesis: none;
		-webkit-font-smoothing: antialiased;
		text-rendering: optimizeLegibility;
	}

	/* Dark theme Apple variables */
	:root.dark {
		/* Apple-style Typography Variables - Dark Theme */
		--sk-body-text-color: rgba(255,255,255,0.85);
		--sk-headline-text-color: rgba(255,255,255,0.95);
		--sk-body-background-color: rgb(28,28,30);
		--sk-focus-color: #0071e3;
		--sk-focus-color-alt: rgba(255,255,255,0.9);
		
		/* Apple-style Grays - Dark Theme */
		--sk-glyph-gray: rgba(255,255,255,0.95);
		--sk-glyph-gray-secondary: rgba(255,255,255,0.68);
		--sk-glyph-gray-tertiary: rgba(255,255,255,0.55);
		--sk-fill-secondary: rgb(44,44,46);
		--sk-fill-tertiary: rgb(58,58,60);
		--sk-fill-gray-quaternary: rgb(72,72,74);
	}

	* {
		margin: 0;
		padding: 0;
		box-sizing: border-box;
	}

	html {
		scroll-behavior: smooth;
		height: 100%;
	}

	body {
		margin: 0;
		font-family: var(--bs-body-font-family);
		font-size: var(--bs-body-font-size);
		font-weight: var(--bs-body-font-weight);
		line-height: var(--bs-body-line-height);
		color: var(--bs-body-color);
		text-align: var(--bs-body-text-align);
		background-color: var(--bs-body-bg);
		-webkit-text-size-adjust: 100%;
		-webkit-tap-highlight-color: rgba(0,0,0,0);
		-webkit-font-smoothing: antialiased;
		font-synthesis: none;
		text-rendering: optimizeLegibility;
		letter-spacing: .009em;
		height: 100%;
	}

	/* Native System Font Classes */
	.sf-light {
		font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
		font-optical-sizing: auto;
		font-weight: 300;
		font-style: normal;
		-webkit-font-smoothing: antialiased;
		letter-spacing: .009em;
	}

	.sf-regular {
		font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
		font-optical-sizing: auto;
		font-weight: 400;
		font-style: normal;
		-webkit-font-smoothing: antialiased;
		letter-spacing: .009em;
	}

	.sf-medium {
		font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
		font-optical-sizing: auto;
		font-weight: 500;
		font-style: normal;
		-webkit-font-smoothing: antialiased;
		letter-spacing: .009em;
	}

	.sf-semibold {
		font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
		font-optical-sizing: auto;
		font-weight: 600;
		font-style: normal;
		-webkit-font-smoothing: antialiased;
		letter-spacing: .009em;
	}

	.sf-bold {
		font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
		font-optical-sizing: auto;
		font-weight: 700;
		font-style: normal;
		-webkit-font-smoothing: antialiased;
		letter-spacing: .009em;
	}

	.sf-extrabold {
		font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
		font-optical-sizing: auto;
		font-weight: 800;
		font-style: normal;
		-webkit-font-smoothing: antialiased;
		letter-spacing: .009em;
	}

	.sf-black {
		font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
		font-optical-sizing: auto;
		font-weight: 900;
		font-style: normal;
		-webkit-font-smoothing: antialiased;
		letter-spacing: .009em;
	}

	/* Apply Apple-style typography to all headings */
	h1, h2, h3, h4, h5, h6 {
		font-family: var(--bs-font-family-heading);
		-webkit-font-smoothing: antialiased;
		letter-spacing: .009em;
		font-optical-sizing: auto;
		font-style: normal;
	}

	/* Utility classes */
	.container {
		max-width: 1440px;
		margin: 0 auto;
		padding: 0 2rem;
	}

	/* Service box padding */
	.service-box-padding {
		padding: 1rem;
	}

	/* Only keep the specific utility we actually use */
	.max-w-chat {
		max-width: 75%;
	}

	/* Subtle gradient border animation - MK colors (blue to pink, no light blue) */
	.animate-gradient-slide {
		background: linear-gradient(90deg, transparent, #0071e3, transparent);
		background-size: 200% 100%;
		animation: gradient-slide-color 30s ease-in-out infinite;
	}

	@keyframes gradient-slide-color {
		0% {
			background: linear-gradient(90deg, transparent, #0071e3, transparent);
			background-position: 0% 50%;
		}
		10% {
			background: linear-gradient(90deg, transparent, #0071e3, transparent);
			background-position: 100% 50%;
		}
		20% {
			background: linear-gradient(90deg, transparent, #3366e3, transparent);
			background-position: 50% 50%;
		}
		30% {
			background: linear-gradient(90deg, transparent, #6655e3, transparent);
			background-position: 0% 50%;
		}
		40% {
			background: linear-gradient(90deg, transparent, #9944d3, transparent);
			background-position: 100% 50%;
		}
		50% {
			background: linear-gradient(90deg, transparent, #cc44bb, transparent);
			background-position: 50% 50%;
		}
		60% {
			background: linear-gradient(90deg, transparent, #ff4faa, transparent);
			background-position: 0% 50%;
		}
		70% {
			background: linear-gradient(90deg, transparent, #ff4faa, transparent);
			background-position: 100% 50%;
		}
		80% {
			background: linear-gradient(90deg, transparent, #cc44bb, transparent);
			background-position: 50% 50%;
		}
		90% {
			background: linear-gradient(90deg, transparent, #6655e3, transparent);
			background-position: 0% 50%;
		}
		100% {
			background: linear-gradient(90deg, transparent, #0071e3, transparent);
			background-position: 0% 50%;
		}
	}

	/* Dark gradient animation for footer background */
	.animate-gradient-flow {
		background-size: 400% 400%;
		animation: gradient-flow 8s ease-in-out infinite;
	}

	@keyframes gradient-flow {
		0% {
			background-position: 0% 50%;
		}
		25% {
			background-position: 100% 50%;
		}
		50% {
			background-position: 100% 50%;
		}
		75% {
			background-position: 0% 50%;
		}
		100% {
			background-position: 0% 50%;
		}
	}

	/* Apple-style Typography Classes */
	.apple-headline {
		line-height: 1.1666666667;
		font-weight: 650;
		letter-spacing: -.009em;
		-webkit-font-smoothing: antialiased;
		text-rendering: optimizeLegibility;
		color: var(--sk-headline-text-color);
	}

	.apple-body-text {
		line-height: 1.2666666667;
		letter-spacing: -.009em;
		-webkit-font-smoothing: antialiased;
		text-rendering: optimizeLegibility;
		color: var(--sk-body-text-color);
	}

	.apple-gradient-text {
		background: linear-gradient(45deg, #0071e3, #ff4faa);
		background-size: 200% 200%;
		-webkit-background-clip: text;
		background-clip: text;
		-webkit-text-fill-color: transparent;
		animation: apple-gradient-flow 15s ease-in-out infinite;
	}

	.apple-gradient-container {
		position: relative;
		/* Remove forced background, let theme handle it */
	}

	/* Apple-style Button Enhancements */
	.apple-button {
		font-family: var(--bs-font-family-heading);
		font-weight: 600;
		letter-spacing: .009em;
		-webkit-font-smoothing: antialiased;
		border-radius: 12px;
		transition: all 0.25s ease;
		border: 1px solid transparent;
		position: relative;
		overflow: hidden;
	}

	.apple-button:hover {
		transform: translateY(-1px);
		box-shadow: 0 8px 25px rgba(0,0,0,0.15);
	}

	.apple-button:active {
		transform: translateY(0);
		box-shadow: 0 4px 12px rgba(0,0,0,0.1);
	}

	/* Apple Gradient Animation */
	@keyframes apple-gradient-flow {
		0%, 100% {
			background-position: 0% 50%;
		}
		50% {
			background-position: 100% 50%;
		}
	}

	/* Apple-style Focus States */
	.apple-focus:focus {
		outline: var(--sk-focus-offset) solid var(--sk-focus-color);
		outline-offset: var(--sk-focus-offset);
		box-shadow: 0 0 0 3px rgba(0, 113, 227, 0.2);
	}

	/* Apple-style Card Effects */
	.apple-card {
		background: var(--sk-fill-secondary);
		border: 1px solid var(--sk-fill-gray-quaternary);
		border-radius: 12px;
		transition: all 0.25s ease;
	}

	.apple-card:hover {
		transform: translateY(-2px);
		box-shadow: 0 12px 30px rgba(0,0,0,0.12);
	}

	/* Dark theme overrides for Apple styles */
	@media (prefers-color-scheme: dark) {
		:root.dark .apple-headline {
			color: var(--sk-headline-text-color);
		}
		
		:root.dark .apple-body-text {
			color: var(--sk-body-text-color);
		}
		
		:root.dark .apple-card {
			background: rgba(255,255,255,0.05);
			border-color: rgba(255,255,255,0.1);
		}

		:root.dark .apple-gradient-container {
			background: transparent;
		}
	}

	/* Light theme specific styles */
	@media (prefers-color-scheme: light) {
		:root:not(.dark) .apple-headline {
			color: var(--sk-headline-text-color);
		}
		
		:root:not(.dark) .apple-body-text {
			color: var(--sk-body-text-color);
		}
		
		:root:not(.dark) .apple-card {
			background: var(--sk-fill-secondary);
			border-color: var(--sk-fill-gray-quaternary);
		}

		:root:not(.dark) .apple-gradient-container {
			background: transparent;
		}
	}

	/* 360° rotation animation for footer 360° Services icon */
	.hover\\:rotate-360:hover {
		transform: rotate(360deg);
	}

	/* HERO VISIBILITY FIX: Force hero section to be visible */
	#hero,
	section[id="hero"],
	.apple-gradient-container {
		opacity: 1 !important;
		visibility: visible !important;
		display: flex !important;
		transform: none !important;
		animation: none !important;
		transition: none !important;
	}

	/* DEBUG: Make hero content highly visible */
	#hero h1,
	#hero p {
		opacity: 1 !important;
		visibility: visible !important;
		transform: none !important;
		animation: none !important;
		color: inherit !important;
	}
</style>
