---
// Import the Layout component
import BaseLayout from '../layouts/BaseLayout.astro';
import MarqueeSimple from '../components/MarqueeSimple.astro';
import NavBar from '../components/navigation/NavBar.astro';
import HeroSection from '../components/sections/HeroSection.astro';
import ServicesSection from '../components/sections/ServicesSection.astro';
import ReviewsSection from '../components/sections/ReviewsSection.astro';
import DockMenu from '../components/navigation/DockMenu.astro';
import PageSection from '../components/layout/PageSection.astro';
import ChatBox from '../components/ui/ChatBox.astro';
import ScrollAnimations from '../components/ui/ScrollAnimations.astro';

// ========================================
// ANIMATION CONFIGURATION - Easy Toggle Controls
// ========================================
const ANIMATION_CONFIG = {
	// Search gradient animations in navbar
	searchGradientEnabled: true,
	searchScrollDelay: 0,

	// Scroll-based animations system
	scrollAnimationsEnabled: true,
	
	scrollAnimationDebug: false,

	// Debug mode - logs animation state changes
	debugMode: false
};
---

<BaseLayout title="MannyKnows - AI-Powered E-commerce Solutions">
	<main class="relative bg-light-primary dark:bg-dark-primary text-text-light-primary dark:text-text-dark-primary min-h-screen transition-colors duration-300">
		<!-- Marquee Announcement Section -->
		<MarqueeSimple />

		<!-- Header Container with Subtle Background -->
		<header class="relative bg-gradient-to-t from-gray-50/50 via-gray-100/30 to-gray-50/20 dark:from-gray-900/60 dark:via-slate-800/40 dark:to-gray-900/30 transition-colors duration-300">
            <!-- Navigation -->
            <NavBar
				animationConfig={{
					searchGradientEnabled: ANIMATION_CONFIG.searchGradientEnabled,
					debugMode: ANIMATION_CONFIG.debugMode,
					searchScrollDelay: ANIMATION_CONFIG.searchScrollDelay
				}}
			/>

            <!-- Hero Section -->
            <ScrollAnimations animation="slideInUp" delay={500} debug={true}>
                <HeroSection
                    title="Scale your"
                    highlightedText="business operations"
                    subtitle="Optimize your operations from end to end with intelligent AI. We automate critical tasks across your marketing, sales, and support workflows to boost productivity, cut costs, and drive scalable growth."
                />
            </ScrollAnimations>
        </header>

		<!-- Services Section -->
		<ScrollAnimations animation="fadeIn" delay={200}>
			<ServicesSection />
		</ScrollAnimations>

		<!-- Process Section -->
		<ScrollAnimations animation="slideInUp" delay={300}>
			<PageSection
				id="process"
				title="Our Process"
				subtitle="From discovery to deployment we follow a proven methodology to transform your e-commerce vision into reality"
				variant="alternate"
			>
			</PageSection>
		</ScrollAnimations>

		<!-- Customer Reviews Section -->
		<ScrollAnimations mode="trigger" animation="slideInLeft" delay={100}>
			<ReviewsSection />
		</ScrollAnimations>

		<!-- Floating Chat Box -->
		<ChatBox />

		<!-- Floating Dock Menu -->
		<DockMenu />
	</main>
</BaseLayout>

<script>
	import { ScrollAnimationManager } from '../utils/scrollAnimations.ts';
	import { ScrollDrivenManager } from '../utils/scrollDriven.ts';
	import { CustomAnimationManager } from '../utils/customAnimationManager.ts';

	// Navigation visibility tracking for floating dock
	function initNavigationTracking() {
		const topNav = document.getElementById('topNav');
		const floatingDock = document.getElementById('floatingDock');

		if (!topNav || !floatingDock) return;

		const observer = new IntersectionObserver((entries) => {
			entries.forEach((entry) => {
				if (entry.isIntersecting) {
					// Top nav is visible, hide floating dock
					floatingDock.classList.add('translate-y-full', 'opacity-0');
				} else {
					// Top nav is not visible, show floating dock
					floatingDock.classList.remove('translate-y-full', 'opacity-0');
				}
			});
		}, {
			threshold: 0.1
		});

		observer.observe(topNav);
	}

	// Initialize trigger-based scroll animations
	function initScrollAnimations() {
		const config = {
			enabled: true,
			defaultThreshold: 0.1,
			debugMode: true, // ENABLED for testing
			respectReducedMotion: true
		};

		const scrollManager = ScrollAnimationManager.initialize(config);
		
		if (config.debugMode) {
			console.log('ðŸŽ¬ Trigger-based scroll animations initialized', config);
		}

		(window as any).scrollAnimationManager = scrollManager;
	}

	// Initialize scroll-driven animations  
	function initScrollDrivenAnimations() {
		const config = {
			enabled: true,
			debugMode: true, // ENABLED for testing
			respectReducedMotion: true,
			throttleMs: 16 // ~60fps
		};

		const scrollDrivenManager = ScrollDrivenManager.initialize(config);
		
		if (config.debugMode) {
			console.log('ï¿½ Scroll-driven animations initialized', config);
		}

		(window as any).scrollDrivenManager = scrollDrivenManager;
	}

	// Initialize custom animations with scroll hijacking
	function initCustomAnimations() {
		const config = {
			enabled: false, // DISABLED - using simple scroll-controlled reviews instead
			debugMode: false,
			respectReducedMotion: true
		};

		const customAnimationManager = CustomAnimationManager.initialize(config);
		(window as any).customAnimationManager = customAnimationManager;
	}

	// Initialize when DOM is loaded
	document.addEventListener('DOMContentLoaded', () => {
		initNavigationTracking();
		initScrollAnimations();
		initScrollDrivenAnimations();
		initCustomAnimations();
	});
</script>