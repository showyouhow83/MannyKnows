---
// Import the Layout component
import BaseLayout from '../layouts/BaseLayout.astro';
import MarqueeSimple from '../components/MarqueeSimple.astro';
import NavBar from '../components/navigation/NavBar.astro';
import HeroSection from '../components/sections/HeroSection.astro';
import ServicesSection from '../components/sections/ServicesSection.astro';
import ReviewsSection from '../components/sections/ReviewsSection.astro';
import DockMenu from '../components/navigation/DockMenu.astro';
import PageSection from '../components/layout/PageSection.astro';
import ProcessSectionAlt from '../components/sections/ProcessSectionAlt.astro';
import ChatBox from '../components/ui/ChatBox.astro';
// ========================================
// NAVBAR CONFIGURATION
// ========================================
const NAVBAR_CONFIG = {
	// Search gradient animations in navbar
	searchGradientEnabled: true,
	searchScrollDelay: 0,
	
	// Debug mode for development
	debugMode: false,
};
---

<BaseLayout title="MK - AI-Powered Software on-demand & E-commerce Solutions by Manny">
	<main class="relative bg-light-primary dark:bg-dark-primary text-text-light-primary dark:text-text-dark-primary min-h-screen transition-colors duration-300">
		<!-- Marquee Announcement Section -->
		<MarqueeSimple />

		<!-- Header Container with Subtle Background -->
		<header class="relative bg-gradient-to-t from-gray-50/50 via-gray-100/30 to-gray-50/20 dark:from-gray-900/60 dark:via-slate-800/40 dark:to-gray-900/30 transition-colors duration-300">
            <!-- Navigation -->
            <NavBar
				animationConfig={{
					searchGradientEnabled: NAVBAR_CONFIG.searchGradientEnabled,
					debugMode: NAVBAR_CONFIG.debugMode,
					searchScrollDelay: NAVBAR_CONFIG.searchScrollDelay
				}}
			/>

            <!-- Hero Section -->
            <HeroSection
                title="Scale your"
                highlightedText="business operations"
                subtitle="Optimize your operations from end to end with intelligent AI. We automate critical tasks across your marketing, sales, and support workflows to boost productivity, cut costs, and drive scalable growth."
            />
        </header>

		<!-- Services Section -->
		<ServicesSection />

		<!-- Products Section -->
		<PageSection
			id="products"
			title="Our Products"
			subtitle="Discover our range of AI-powered e-commerce solutions designed to elevate your business."
			variant="alternate"
		>

		</PageSection>

		<!-- Process Section -->
		<PageSection
			id="process"
			title="Our Process"
			subtitle="From discovery to deployment we follow a proven methodology to transform your e-commerce vision into reality"
			variant="alternate"
		>
			<ProcessSectionAlt />
		</PageSection>

		<!-- Customer Reviews Section -->
		<ReviewsSection />

		<!-- Chat Box -->
		<ChatBox />

		<!-- Floating Dock Menu -->
		<DockMenu />
	</main>
</BaseLayout>

<script>
  // Handle URL parameters for chat opening and reference tracking
  document.addEventListener('DOMContentLoaded', () => {
    const urlParams = new URLSearchParams(window.location.search);
    const chatParam = urlParams.get('chat');
    const refParam = urlParams.get('ref');
    
    // Auto-open chat if ?chat=open parameter is present
    if (chatParam === 'open') {
      // Small delay to ensure ChatBox component is initialized
      setTimeout(() => {
        const chatToggle = document.getElementById('dockChatToggle') || 
                          document.getElementById('topChatToggle') || 
                          document.getElementById('heroChatButton');
        
        if (chatToggle) {
          chatToggle.click();
          
          // If there's a reference parameter, store it and trigger contextual greeting
          if (refParam) {
            try {
              sessionStorage.setItem('mk_chat_reference', refParam);
              console.log('ðŸ“§ Chat opened with reference:', refParam);
              
              // Trigger contextual AI greeting after chat opens
              setTimeout(() => {
                const chatInput = document.getElementById('chatBoxInput');
                if (chatInput && (window as any).triggerContextualGreeting) {
                  (window as any).triggerContextualGreeting(refParam);
                }
              }, 1000);
            } catch (e) {
              console.warn('Could not store chat reference:', e);
            }
          }
        } else {
          console.warn('Chat toggle button not found');
        }
      }, 500);
    }
    
    // Clean up URL parameters after processing (optional - keeps URL clean)
    if (chatParam || refParam) {
      const cleanUrl = window.location.pathname;
      window.history.replaceState({}, document.title, cleanUrl);
    }
  });
</script>