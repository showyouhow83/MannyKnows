---
import Button from '../ui/Button.astro';

interface AnimationConfig {
  searchGradientEnabled?: boolean;
  debugMode?: boolean;
  searchScrollDelay?: number;
}

interface Props {
  className?: string;
  animationConfig?: AnimationConfig;
}

const { 
  className = "",
  animationConfig = {
    searchGradientEnabled: true,
    debugMode: false,
    searchScrollDelay: 0
  }
} = Astro.props;

const navLinks = [
  { href: "#services", label: "Services" },
  { href: "#products", label: "Products" },
  { href: "#process", label: "Process" },
  { href: "#reviews", label: "Reviews" },
];
---

<nav id="topNav" class={`bg-transparent min-h-[4.05rem] relative flex items-center border-b border-gray-300/30 dark:border-white/10 ${className}`}>
  <div class="max-w-[1440px] mx-auto px-2 w-full">
    <!-- Desktop Layout -->
    <div class="hidden xl:flex justify-between items-center w-full">
      <!-- Logo -->
      <h1 class="text-5xl font-black m-0">
        <a href="/" class="logo-gradient text-text-light-primary dark:text-text-dark-primary font-black transition-all duration-500 hover:-translate-y-1 hover:scale-105 no-underline relative overflow-hidden before:content-[''] before:absolute before:inset-0 before:bg-gradient-to-r before:from-transparent before:via-white/6 before:to-transparent before:-translate-x-full before:animate-subtle-shimmer before:pointer-events-none">
          MK
        </a>
      </h1>

      <!-- Navigation Menu -->
      <ul class="flex list-none gap-8 m-0 p-0 flex-1 justify-center ml-8">
        {navLinks.map((link) => (
          <li>
            <a
              href={link.href}
              class="nav-gradient text-text-light-primary dark:text-text-dark-primary font-medium transition-all duration-500 hover:-translate-y-1 no-underline relative overflow-hidden before:content-[''] before:absolute before:inset-0 before:bg-gradient-to-r before:from-transparent before:via-white/6 before:to-transparent before:-translate-x-full before:animate-subtle-shimmer before:pointer-events-none"
            >
              {link.label}
            </a>
          </li>
        ))}
      </ul>

      <!-- Search Bar -->
      <div class="relative flex items-center flex-1 mx-4">
        <label for="search-input" class="absolute -left-[10000px] opacity-0 pointer-events-none">Browse Services Catalog</label>
        <input
          id="search-input"
          type="search"
          placeholder="Browse services catalog..."
          class="bg-black/10 dark:bg-white/10 border border-border-light dark:border-border-dark rounded-lg py-3 pl-4 pr-10 text-text-light-primary dark:text-text-dark-primary text-sm w-full h-12 transition-all duration-300 backdrop-blur-lg placeholder:text-text-light-tertiary dark:placeholder:text-text-dark-tertiary focus:outline-none focus:border-primary-blue/50 focus:bg-black/20 dark:focus:bg-white/20 focus:shadow-[0_0_0_2px_rgba(16,209,255,0.2)]"
        />
        <button type="button" class="absolute right-2 bg-none border-none text-text-light-tertiary dark:text-text-dark-tertiary cursor-pointer p-1 rounded transition-colors duration-300 flex items-center justify-center hover:text-text-light-primary dark:hover:text-text-dark-primary" aria-label="Search">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
        </button>
      </div>

      <!-- Navigation Actions -->
      <div class="flex items-center gap-2 relative">
        <Button
          href="#instant-quote"
          text="FREE 360 PHOTO"
          subtext="CLAIM NOW"
          id="instant-quote-btn"
          variant="theme-aware"
          sparkles={true}
          sparkleTheme="purple"
        />

        <Button
          href="#apple-quote"
          text="FREE WEBSITE"
          subtext="EXPIRING SOON"
          variant="emoji"
          emoji="ðŸš€"
          emojiAnimation="subtle"
          sparkles={false}
          className="text-[10px] text-white/80 leading-none"
        />

        <button type="button" class="group bg-gradient-to-br from-green-500 via-emerald-500 to-green-600 bg-200 border border-green-400/30 rounded-lg text-white w-12 h-12 flex items-center justify-center cursor-pointer transition-all duration-300 relative overflow-hidden hover:scale-105 hover:shadow-[0_8px_25px_rgba(34,197,94,0.4)] animate-green-gradient-flow before:content-[''] before:absolute before:inset-0 before:bg-gradient-to-r before:from-transparent before:via-white/8 before:to-transparent before:-translate-x-full before:animate-green-shimmer" id="topChatToggle">
          <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="relative z-10">
            <path d="M12 8V4H8"/>
            <rect width="16" height="12" x="4" y="8" rx="2"/>
            <path d="M2 14h2"/>
            <path d="M20 14h2"/>
            <path d="M15 13v2"/>
            <path d="M9 13v2"/>
          </svg>
          <!-- Tooltip -->
          <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-black dark:bg-white text-white dark:text-black text-sm whitespace-nowrap rounded opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50 shadow-lg pointer-events-none" role="tooltip">
            Talk to Us
          </div>
        </button>
      </div>
    </div>

    <!-- Mobile Layout -->
    <div class="flex xl:hidden items-center w-full h-16 px-0">
      <!-- Logo - 15% -->
      <div class="flex-[0_0_15%] flex items-center">
        <h1 class="text-3xl font-black m-0 leading-none">
          <a href="/" class="logo-gradient text-text-light-primary dark:text-text-dark-primary font-black transition-all duration-500 hover:-translate-y-1 hover:scale-105 no-underline relative overflow-hidden before:content-[''] before:absolute before:inset-0 before:bg-gradient-to-r before:from-transparent before:via-white/6 before:to-transparent before:-translate-x-full before:animate-subtle-shimmer before:pointer-events-none">
            MK
          </a>
        </h1>
      </div>

      <!-- Search Bar - 70% -->
      <div class="flex-[0_0_70%] flex items-center px-2">
        <div class="relative flex items-center w-full">
          <label for="search-input-mobile" class="absolute -left-[10000px] opacity-0 pointer-events-none">Browse Services Catalog</label>
          <input
            id="search-input-mobile"
            type="search"
            placeholder="Browse services catalog..."
            class="bg-black/10 dark:bg-white/10 border border-border-light dark:border-border-dark rounded-lg py-2 pl-3 pr-8 text-text-light-primary dark:text-text-dark-primary text-sm w-full h-10 transition-all duration-300 backdrop-blur-lg placeholder:text-text-light-tertiary dark:placeholder:text-text-dark-tertiary focus:outline-none focus:border-primary-blue/50 focus:bg-black/20 dark:focus:bg-white/20 focus:shadow-[0_0_0_2px_rgba(16,209,255,0.2)]"
          />
          <button type="button" class="absolute right-2 bg-none border-none text-text-light-tertiary dark:text-text-dark-tertiary cursor-pointer p-1 rounded transition-colors duration-300 flex items-center justify-center h-6 w-6 hover:text-text-light-primary dark:hover:text-text-dark-primary" aria-label="Search">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
              <circle cx="11" cy="11" r="8"></circle>
              <path d="m21 21-4.35-4.35"></path>
            </svg>
          </button>
        </div>
      </div>

      <!-- Hamburger Menu - 15% -->
      <div class="flex-[0_0_15%] flex justify-center items-center">
        <button
          type="button"
          id="mobile-menu-toggle"
          class="p-2 rounded-lg text-text-light-primary dark:text-text-dark-primary hover:bg-black/10 dark:hover:bg-white/10 transition-colors duration-300 flex items-center justify-center"
          aria-label="Toggle mobile menu"
          aria-expanded="false"
        >
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="hamburger-icon">
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <line x1="3" y1="12" x2="21" y2="12"></line>
            <line x1="3" y1="18" x2="21" y2="18"></line>
          </svg>
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="close-icon hidden">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile Menu Overlay -->
  <div id="mobile-menu" class="fixed inset-0 z-50 xl:hidden transform translate-x-full transition-transform duration-300 ease-in-out">
    <!-- Light Glassmorphism Background -->
    <div id="mobile-menu-backdrop" class="absolute inset-0 bg-white/20 dark:bg-gray-900/25 backdrop-blur-xl"></div>
    
    <!-- Menu Content -->
    <div class="relative h-full w-80 ml-auto flex flex-col bg-white/90 dark:bg-gray-900/85 backdrop-blur-xl border-l border-gray-300/30 dark:border-white/20 shadow-xl">
      <!-- Header with Close Button -->
      <div class="flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700">
        <h2 class="text-xl font-semibold text-text-light-primary dark:text-text-dark-primary">Menu</h2>
        <button 
          type="button" 
          id="mobile-menu-close"
          class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors duration-200"
          aria-label="Close mobile menu"
        >
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-text-light-primary dark:text-text-dark-primary">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      
      <!-- Navigation Links -->
      <div class="flex-1 px-6 py-8 space-y-6">
        {navLinks.map((link) => (
          <a
            href={link.href}
            class="mobile-nav-link block text-lg font-medium text-text-light-primary dark:text-text-dark-primary hover:text-primary-blue dark:hover:text-primary-blue transition-colors duration-200"
          >
            {link.label}
          </a>
        ))}
      </div>
      
      <!-- Action Buttons -->
      <div class="p-6 border-t border-gray-200 dark:border-gray-700 space-y-3">
        <Button
          href="#instant-quote"
          text="FREE 360 PHOTO"
          subtext="CLAIM NOW"
          variant="theme-aware"
          className="w-full text-center"
        />
        <Button
          href="#apple-quote"
          text="FREE WEBSITE"
          subtext="EXPIRING SOON"
          variant="emoji"
          emoji="ðŸš€"
          emojiAnimation="subtle"
          sparkles={false}
          className="w-full text-center text-[10px] text-white/80 leading-none"
        />
      </div>
    </div>
  </div>
</nav>

<style>
  /* Search bar apple gradient animation */
  #search-input.apple-gradient-active,
  #search-input-mobile.apple-gradient-active {
    background: linear-gradient(45deg, #0071e3, #ff4faa, #10d1ff);
    background-size: 200% 200%;
    animation: search-gradient-flow 3s ease-in-out infinite;
    border: 2px solid transparent;
    background-clip: padding-box;
    position: relative;
  }

  #search-input.apple-gradient-active::before,
  #search-input-mobile.apple-gradient-active::before {
    content: '';
    position: absolute;
    inset: 0;
    padding: 2px;
    background: linear-gradient(45deg, #0071e3, #ff4faa, #10d1ff);
    background-size: 200% 200%;
    border-radius: inherit;
    mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    mask-composite: exclude;
    animation: search-gradient-flow 3s ease-in-out infinite;
    z-index: -1;
  }

  /* Search gradient animation keyframes */
  @keyframes search-gradient-flow {
    0% {
      background-position: 0% 50%;
    }
    25% {
      background-position: 100% 50%;
    }
    50% {
      background-position: 100% 50%;
    }
    75% {
      background-position: 0% 50%;
    }
    100% {
      background-position: 0% 50%;
    }
  }

  /* Disable search gradient animation when setting is off */
  .search-gradient-disabled #search-input.apple-gradient-active,
  .search-gradient-disabled #search-input-mobile.apple-gradient-active {
    animation: none !important;
    background: #0071e3 !important;
  }

  .search-gradient-disabled #search-input.apple-gradient-active::before,
  .search-gradient-disabled #search-input-mobile.apple-gradient-active::before {
    animation: none !important;
    background: #0071e3 !important;
  }

  /* Theme-aware gradient hover effects for navigation */
  .logo-gradient,
  .nav-gradient {
    background: linear-gradient(45deg, #10d1ff, #ff4faa);
    background-size: 300% 300%;
    -webkit-background-clip: text;
    background-clip: text;
    transition: all 0.5s ease;
  }

  .logo-gradient:hover,
  .nav-gradient:hover {
    background: linear-gradient(45deg, #0071e3, #ff4faa, #10d1ff);
    background-size: 200% 200%;
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: apple-gradient-flow 2s ease-in-out infinite;
  }

  /* Apple gradient flow animation for navigation */
  @keyframes apple-gradient-flow {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
  }

  /* Mobile Menu Styles */
  .mobile-nav-link {
    position: relative;
    display: block;
    overflow: hidden;
  }

  .mobile-nav-link::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 0;
    height: 2px;
    background: linear-gradient(45deg, #10d1ff, #ff4faa);
    transition: width 0.3s ease;
  }

  .mobile-nav-link:hover::after {
    width: 100%;
  }

  /* Mobile menu animations */
  #mobile-menu.menu-open {
    transform: translateX(0);
  }

  /* Hamburger icon animation */
  #mobile-menu-toggle .hamburger-icon,
  #mobile-menu-toggle .close-icon {
    transition: opacity 0.2s ease;
  }

  #mobile-menu-toggle[aria-expanded="true"] .hamburger-icon {
    opacity: 0;
  }

  #mobile-menu-toggle[aria-expanded="true"] .close-icon {
    opacity: 1;
  }

  #mobile-menu-toggle[aria-expanded="false"] .close-icon {
    opacity: 0;
  }

  /* Responsive navigation styles */
  @media (max-width: 1111px) {
    /* Remove column direction for mobile layout */
    .nav-search {
      @apply mx-0;
    }
    .search-input {
      @apply min-w-64;
    }
  }
</style>

<script define:vars={{ animationConfig }}>
  // Search input apple gradient animation
  function initSearchAnimation() {
    if (!animationConfig.searchGradientEnabled) {
      if (animationConfig.debugMode) console.log('Search gradient animation disabled');
      return;
    }

    const searchInput = document.getElementById('search-input');
    const searchInputMobile = document.getElementById('search-input-mobile');
    
    [searchInput, searchInputMobile].forEach(input => {
      if (!input) return;

      if (animationConfig.debugMode) console.log('Search gradient animation enabled');

      // Add gradient on focus
      const addGradient = () => {
        input.classList.add('apple-gradient-active');
        if (animationConfig.debugMode) console.log('Search gradient activated');
      };

      // Remove gradient
      const removeGradient = () => {
        input.classList.remove('apple-gradient-active');
        if (animationConfig.debugMode) console.log('Search gradient deactivated');
      };

      // Event listeners
      input.addEventListener('focus', addGradient);
      input.addEventListener('blur', removeGradient);
    });
    
    // Remove gradient on scroll (user is moving away)
    let scrollTimeout;
    const handleScroll = () => {
      [searchInput, searchInputMobile].forEach(input => {
        if (input && input.classList.contains('apple-gradient-active')) {
          clearTimeout(scrollTimeout);
          scrollTimeout = setTimeout(() => input.classList.remove('apple-gradient-active'), animationConfig.searchScrollDelay);
        }
      });
    };
    
    window.addEventListener('scroll', handleScroll, { passive: true });

    // Apply animation settings
    const body = document.body;
    if (!animationConfig.searchGradientEnabled) {
      body.classList.add('search-gradient-disabled');
      if (animationConfig.debugMode) console.log('Search gradient disabled via CSS class');
    } else {
      body.classList.remove('search-gradient-disabled');
    }
  }

  // Mobile menu functionality
  function initMobileMenu() {
    console.log('Initializing mobile menu...');
    const menuToggle = document.getElementById('mobile-menu-toggle');
    const mobileMenu = document.getElementById('mobile-menu');
    const mobileMenuClose = document.getElementById('mobile-menu-close');
    const mobileNavLinks = document.querySelectorAll('.mobile-nav-link');
    
    console.log('Menu toggle:', menuToggle);
    console.log('Mobile menu:', mobileMenu);
    console.log('Mobile nav links:', mobileNavLinks);
    console.log('Mobile menu close:', mobileMenuClose);
    
    if (!menuToggle || !mobileMenu) {
      console.error('Mobile menu elements not found!');
      return;
    }

    let isMenuOpen = false;

    const openMenu = () => {
      console.log('Opening mobile menu...');
      isMenuOpen = true;
      mobileMenu.classList.add('menu-open');
      menuToggle.setAttribute('aria-expanded', 'true');
      menuToggle.querySelector('.hamburger-icon').classList.add('hidden');
      menuToggle.querySelector('.close-icon').classList.remove('hidden');
      document.body.style.overflow = 'hidden'; // Prevent body scroll
    };

    const closeMenu = () => {
      console.log('Closing mobile menu...');
      isMenuOpen = false;
      mobileMenu.classList.remove('menu-open');
      menuToggle.setAttribute('aria-expanded', 'false');
      menuToggle.querySelector('.hamburger-icon').classList.remove('hidden');
      menuToggle.querySelector('.close-icon').classList.add('hidden');
      document.body.style.overflow = ''; // Restore body scroll
    };

    // Toggle menu on button click
    menuToggle.addEventListener('click', (e) => {
      console.log('Menu toggle clicked!', e);
      if (isMenuOpen) {
        closeMenu();
      } else {
        openMenu();
      }
    });

    // Close menu on close button click
    if (mobileMenuClose) {
      mobileMenuClose.addEventListener('click', closeMenu);
    }

    // Close menu when clicking on navigation links
    mobileNavLinks.forEach(link => {
      link.addEventListener('click', closeMenu);
    });

    // Close menu when clicking outside (on backdrop)
    const mobileMenuBackdrop = document.getElementById('mobile-menu-backdrop');
    if (mobileMenuBackdrop) {
      mobileMenuBackdrop.addEventListener('click', (e) => {
        console.log('Backdrop clicked, closing menu');
        closeMenu();
      });
    }

    // Also handle clicks on the menu overlay itself
    mobileMenu.addEventListener('click', (e) => {
      // Only close if clicking directly on the menu overlay (not on menu content)
      if (e.target === mobileMenu) {
        console.log('Menu overlay clicked, closing menu');
        closeMenu();
      }
    });

    // Close menu on escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && isMenuOpen) {
        closeMenu();
      }
    });

    // Close menu on window resize to desktop
    window.addEventListener('resize', () => {
      if (window.innerWidth >= 1111 && isMenuOpen) {
        closeMenu();
      }
    });
    
    console.log('Mobile menu initialized successfully!');
  }

  // Developer utility - accessible from browser console
  if (!window.MannyKnowsNavigation) {
    window.MannyKnowsNavigation = {
      searchAnimation: {
        config: animationConfig,
        toggle: () => {
          animationConfig.searchGradientEnabled = !animationConfig.searchGradientEnabled;
          console.log(`Search gradient: ${animationConfig.searchGradientEnabled ? 'enabled' : 'disabled'}`);
          console.log('Refresh page to see changes');
        },
        status: () => {
          console.table(animationConfig);
        }
      },
      mobileMenu: {
        open: () => document.getElementById('mobile-menu-toggle')?.click(),
        close: () => {
          const menu = document.getElementById('mobile-menu');
          if (menu && menu.classList.contains('menu-open')) {
            document.getElementById('mobile-menu-toggle')?.click();
          }
        }
      }
    };
  }

  // Initialize when DOM is ready
  document.addEventListener('DOMContentLoaded', () => {
    initSearchAnimation();
    initMobileMenu();
  }, { passive: true });
</script>
