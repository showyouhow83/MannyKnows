---
import Button from '../ui/Button.astro';

interface AnimationConfig {
  searchGradientEnabled?: boolean;
  debugMode?: boolean;
  searchScrollDelay?: number;
}

interface Props {
  className?: string;
  animationConfig?: AnimationConfig;
}

const { 
  className = "",
  animationConfig = {
    searchGradientEnabled: true,
    debugMode: false,
    searchScrollDelay: 0
  }
} = Astro.props;

const navLinks = [
  { href: "#services", label: "Services" },
  { href: "#products", label: "Products" },
  { href: "#process", label: "Process" },
  { href: "#reviews", label: "Reviews" },
];
---

<nav id="topNav" class={`bg-transparent min-h-[4.05rem] relative flex items-center border-b border-gray-300/30 dark:border-white/10 ${className}`}>
  <div class="max-w-[1440px] mx-auto px-2 w-full">
    <!-- Desktop Layout -->
    <div class="hidden xl:flex justify-between items-center w-full">
      <!-- Logo -->
      <h1 class="text-5xl font-black m-0">
        <a href="/" class="logo-gradient text-text-light-primary dark:text-text-dark-primary font-black transition-all duration-500 no-underline relative overflow-hidden before:content-[''] before:absolute before:inset-0 before:bg-gradient-to-r before:from-transparent before:via-white/6 before:to-transparent before:-translate-x-full before:animate-subtle-shimmer before:pointer-events-none">
          MK
        </a>
      </h1>

      <!-- Navigation Menu -->
      <ul class="flex list-none gap-8 m-0 p-0 flex-1 justify-center ml-8">
        {navLinks.map((link) => (
          <li>
            <a
              href={link.href}
              class="nav-gradient text-text-light-primary dark:text-text-dark-primary font-medium transition-all duration-500 hover:-translate-y-1 no-underline relative overflow-hidden before:content-[''] before:absolute before:inset-0 before:bg-gradient-to-r before:from-transparent before:via-white/6 before:to-transparent before:-translate-x-full before:animate-subtle-shimmer before:pointer-events-none"
            >
              {link.label}
            </a>
          </li>
        ))}
      </ul>

      <!-- Search Bar -->
      <div class="relative flex items-center flex-1 mx-4">
        <label for="search-input" class="absolute -left-[10000px] opacity-0 pointer-events-none">Browse Services Catalog</label>
        <input
          id="search-input"
          type="search"
          placeholder="Browse services catalog..."
          class="bg-black/10 dark:bg-white/10 border border-border-light dark:border-border-dark rounded-lg py-3 pl-4 pr-10 text-text-light-primary dark:text-text-dark-primary text-sm w-full h-12 transition-all duration-300 backdrop-blur-lg placeholder:text-text-light-tertiary dark:placeholder:text-text-dark-tertiary focus:outline-none focus:border-primary-blue/50 focus:bg-black/20 dark:focus:bg-white/20 focus:shadow-[0_0_0_2px_rgba(16,209,255,0.2)]"
        />
        <button type="button" class="absolute right-2 bg-none border-none text-text-light-tertiary dark:text-text-dark-tertiary cursor-pointer p-1 rounded transition-colors duration-300 flex items-center justify-center hover:text-text-light-primary dark:hover:text-text-dark-primary" aria-label="AI Search">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <path d="M12 0l1.5 4.5L18 6l-4.5 1.5L12 12l-1.5-4.5L6 6l4.5-1.5L12 0z"/>
            <path d="M20 8l1 3 3 1-3 1-1 3-1-3-3-1 3-1 1-3z"/>
            <path d="M4 16l0.8 2.4L7.2 19.2l-2.4 0.8L4 22.4l-0.8-2.4L0.8 19.2l2.4-0.8L4 16z"/>
          </svg>
        </button>
      </div>

      <!-- Navigation Actions -->
      <div class="flex items-center gap-2 relative">
        <Button
          href="#instant-quote"
          text="FREE 360 PHOTO"
          subtext="CLAIM NOW"
          id="instant-quote-btn"
          variant="theme-aware"
          sparkles={true}
          sparkleTheme="purple"
        />

        <Button
          href="#apple-quote"
          text="FREE WEBSITE"
          subtext="AI ANALYSIS"
          variant="emoji"
          emoji="ðŸš€"
          emojiAnimation="subtle"
          sparkles={false}
          className="text-[10px] text-white/80 leading-none"
        />

        <button type="button" class="group bg-gradient-to-br from-green-500 via-emerald-500 to-green-600 bg-200 border border-green-400/30 rounded-lg text-white w-12 h-12 flex items-center justify-center cursor-pointer transition-all duration-300 relative overflow-hidden hover:scale-105 hover:shadow-[0_8px_25px_rgba(34,197,94,0.4)] animate-green-gradient-flow before:content-[''] before:absolute before:inset-0 before:bg-gradient-to-r before:from-transparent before:via-white/8 before:to-transparent before:-translate-x-full before:animate-green-shimmer" id="topChatToggle">
          <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="relative z-10">
            <path d="M12 8V4H8"/>
            <rect width="16" height="12" x="4" y="8" rx="2"/>
            <path d="M2 14h2"/>
            <path d="M20 14h2"/>
            <path d="M15 13v2"/>
            <path d="M9 13v2"/>
          </svg>
          <!-- Tooltip -->
          <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-black dark:bg-white text-white dark:text-black text-sm whitespace-nowrap rounded opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50 shadow-lg pointer-events-none" role="tooltip">
            Talk to Us
          </div>
        </button>
      </div>
    </div>

    <!-- Mobile Layout -->
    <div class="flex xl:hidden items-center w-full h-16 px-0">
      <!-- Logo - 15% -->
      <div class="flex-[0_0_15%] flex items-center">
        <h1 class="text-3xl font-black m-0 leading-none">
          <a href="/" class="logo-gradient text-text-light-primary dark:text-text-dark-primary font-black transition-all duration-500 no-underline relative overflow-hidden before:content-[''] before:absolute before:inset-0 before:bg-gradient-to-r before:from-transparent before:via-white/6 before:to-transparent before:-translate-x-full before:animate-subtle-shimmer before:pointer-events-none">
            MK
          </a>
        </h1>
      </div>

      <!-- Search Bar - 70% -->
      <div class="flex-[0_0_70%] flex items-center px-2">
        <div class="relative flex items-center w-full">
          <label for="search-input-mobile" class="absolute -left-[10000px] opacity-0 pointer-events-none">Browse Services Catalog</label>
          <input
            id="search-input-mobile"
            type="search"
            placeholder="Browse services catalog..."
            class="bg-black/10 dark:bg-white/10 border border-border-light dark:border-border-dark rounded-lg py-2 pl-3 pr-8 text-text-light-primary dark:text-text-dark-primary text-sm w-full h-10 transition-all duration-300 backdrop-blur-lg placeholder:text-text-light-tertiary dark:placeholder:text-text-dark-tertiary focus:outline-none focus:border-primary-blue/50 focus:bg-black/20 dark:focus:bg-white/20 focus:shadow-[0_0_0_2px_rgba(16,209,255,0.2)]"
          />
          <button type="button" class="absolute right-2 bg-none border-none text-text-light-tertiary dark:text-text-dark-tertiary cursor-pointer p-1 rounded transition-colors duration-300 flex items-center justify-center h-6 w-6 hover:text-text-light-primary dark:hover:text-text-dark-primary" aria-label="AI Search">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
              <path d="M12 0l1.5 4.5L18 6l-4.5 1.5L12 12l-1.5-4.5L6 6l4.5-1.5L12 0z"/>
              <path d="M20 8l1 3 3 1-3 1-1 3-1-3-3-1 3-1 1-3z"/>
              <path d="M4 16l0.8 2.4L7.2 19.2l-2.4 0.8L4 22.4l-0.8-2.4L0.8 19.2l2.4-0.8L4 16z"/>
            </svg>
          </button>
        </div>
      </div>

      <!-- Hamburger Menu - 15% -->
      <div class="flex-[0_0_15%] flex justify-center items-center">
        <button
          type="button"
          id="mobile-menu-toggle"
          class="p-2 rounded-lg text-text-light-primary dark:text-text-dark-primary hover:bg-black/10 dark:hover:bg-white/10 transition-colors duration-300 flex items-center justify-center"
          aria-label="Toggle mobile menu"
          aria-expanded="false"
        >
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="hamburger-icon">
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <line x1="3" y1="12" x2="21" y2="12"></line>
            <line x1="3" y1="18" x2="21" y2="18"></line>
          </svg>
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="close-icon hidden">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile Menu Overlay -->
  <div id="mobile-menu" class="fixed inset-0 z-50 xl:hidden transform translate-x-full transition-transform duration-300 ease-in-out">
    <!-- Light Glassmorphism Background -->
    <div id="mobile-menu-backdrop" class="absolute inset-0 bg-white/20 dark:bg-gray-900/25 backdrop-blur-xl"></div>
    
    <!-- Menu Content -->
    <div class="relative h-full w-[95%] ml-auto flex flex-col bg-white/90 dark:bg-gray-900/85 backdrop-blur-xl border-l border-gray-300/30 dark:border-white/20 shadow-xl">
      <!-- Header with Close Button -->
      <div class="flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700">
        <h2 class="text-xl font-semibold text-text-light-primary dark:text-text-dark-primary">Menu</h2>
        <button 
          type="button" 
          id="mobile-menu-close"
          class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors duration-200"
          aria-label="Close mobile menu"
        >
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-text-light-primary dark:text-text-dark-primary">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      
      <!-- Navigation Links -->
      <div class="px-4 py-4 space-y-2">
        {navLinks.map((link) => (
          <a
            href={link.href}
            class="mobile-nav-link block text-base font-medium text-text-light-primary dark:text-text-dark-primary hover:text-primary-blue dark:hover:text-primary-blue transition-colors duration-200"
          >
            {link.label}
          </a>
        ))}
      </div>
      
      <!-- Action Buttons -->
      <div class="p-6 border-t border-gray-200 dark:border-gray-700 space-y-3">
        <div class="flex gap-3">
          <Button
            href="#instant-quote"
            text="FREE 360 PHOTO"
            subtext="CLAIM NOW"
            variant="theme-aware"
            className="flex-1 text-center"
          />
          <Button
            href="#apple-quote"
            text="FREE WEBSITE"
            subtext="AI ANALYSIS"
            variant="emoji"
            emoji="ðŸš€"
            emojiAnimation="subtle"
            sparkles={false}
            className="flex-1 text-center text-[10px] text-white/80 leading-none"
          />
        </div>
        
        <!-- Settings Section -->
        <div class="mt-6">
          <!-- Settings Toggle Button -->
          <button
            type="button"
            id="mobileSettingsToggle"
            class="group w-full p-3 bg-gray-100/50 dark:bg-gray-800/50 hover:bg-gray-200/50 dark:hover:bg-gray-700/50 rounded-lg border border-gray-200 dark:border-gray-600 transition-all duration-200 flex items-center justify-between"
          >
            <div class="flex items-center gap-3">
              <!-- User Preferences Icon -->
              <svg class="w-5 h-5 text-gray-600 dark:text-gray-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                <circle cx="12" cy="7" r="4"/>
              </svg>
              <span class="text-gray-700 dark:text-gray-300 font-medium">User preferences</span>
            </div>
            <svg class="w-4 h-4 text-gray-500 dark:text-gray-400 transition-transform duration-200" id="settingsChevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="6,9 12,15 18,9"></polyline>
            </svg>
          </button>

          <!-- Inline Settings Panel -->
          <div id="mobileSettingsPanel" class="hidden mt-2 p-3 bg-gray-50/50 dark:bg-gray-800/50 rounded-lg border border-gray-200/50 dark:border-gray-600/50 space-y-3">
            
            <!-- Theme Setting -->
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-2">
                <div class="w-6 h-6 bg-gradient-to-br from-blue-500/20 to-indigo-500/20 rounded-md flex items-center justify-center">
                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-blue-600 dark:text-blue-400">
                    <circle cx="12" cy="12" r="5"/>
                    <line x1="12" y1="1" x2="12" y2="3"/>
                    <line x1="12" y1="21" x2="12" y2="23"/>
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                    <line x1="1" y1="12" x2="3" y2="12"/>
                    <line x1="21" y1="12" x2="23" y2="12"/>
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                  </svg>
                </div>
                <div>
                  <div class="text-sm font-medium text-gray-800 dark:text-white">Theme</div>
                  <div class="text-xs text-gray-600 dark:text-gray-400">Light/Dark mode</div>
                </div>
              </div>
              <label class="relative inline-flex items-center cursor-pointer">
                <input 
                  type="checkbox" 
                  id="mobileThemeToggle" 
                  class="sr-only peer"
                  checked
                >
                <!-- Modern iOS-style toggle switch with sliding handle -->
                <div class="relative w-10 h-5 bg-gray-200 dark:bg-gray-700 rounded-full peer-focus:ring-2 peer-focus:ring-blue-300/30 dark:peer-focus:ring-blue-800/30 transition-all duration-300 peer-checked:bg-gradient-to-r peer-checked:from-blue-500 peer-checked:to-indigo-600 shadow-inner"></div>
                  <!-- Sliding toggle handle - direct sibling for peer-checked to work -->
                  <div class="absolute top-0.5 left-0.5 w-4 h-4 bg-white rounded-full shadow-lg transform transition-transform duration-300 peer-checked:translate-x-5 flex items-center justify-center">
                    <!-- Light mode icon (sun) - visible when NOT checked (light mode) -->
                    <svg class="absolute w-3 h-3 text-yellow-500 transition-opacity duration-200 opacity-100 peer-checked:opacity-0" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clip-rule="evenodd"/>
                    </svg>
                    <!-- Dark mode icon (moon) - visible when checked (dark mode) -->
                    <svg class="absolute w-3 h-3 text-slate-700 transition-opacity duration-200 opacity-0 peer-checked:opacity-100" viewBox="0 0 20 20" fill="currentColor">
                      <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"/>
                    </svg>
                  </div>
                </div>
            <!-- Marquee Setting -->
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-2">
                <div class="w-6 h-6 bg-gradient-to-br from-green-500/20 to-emerald-500/20 rounded-md flex items-center justify-center">
                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-green-600 dark:text-green-400">
                    <path d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2 2z"/>
                    <path d="M8 21l4-7 4 7M13 10V7"/>
                  </svg>
                </div>
                <div>
                  <div class="text-sm font-medium text-gray-800 dark:text-white">Marquee</div>
                  <div class="text-xs text-gray-600 dark:text-gray-400">Animated text banner</div>
                </div>
              </div>
              <label class="relative inline-flex items-center cursor-pointer">
                <input 
                  type="checkbox" 
                  id="mobileMarqueeToggle" 
                  class="sr-only peer"
                  checked
                >
                <div class="relative w-10 h-5 bg-gray-200 dark:bg-gray-700 rounded-full peer-focus:ring-2 peer-focus:ring-green-300/30 dark:peer-focus:ring-green-800/30 transition-all duration-300 peer-checked:bg-gradient-to-r peer-checked:from-green-500 peer-checked:to-emerald-600 shadow-inner"></div>
                  <div class="absolute top-0.5 left-0.5 w-4 h-4 bg-white rounded-full shadow-lg transform transition-transform duration-300 peer-checked:translate-x-5 flex items-center justify-center">
                    <!-- Hide icon (eye-slash) - visible when NOT checked -->
                    <svg class="absolute w-3 h-3 text-gray-500 transition-opacity duration-200 opacity-100 peer-checked:opacity-0" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd" d="M3.707 2.293a1 1 0 00-1.414 1.414l14 14a1 1 0 001.414-1.414l-1.473-1.473A10.014 10.014 0 0019.542 10C18.268 5.943 14.478 3 10 3a9.958 9.958 0 00-4.512 1.074l-1.78-1.781zm4.261 4.26l1.514 1.515a2.003 2.003 0 012.45 2.45l1.514 1.514a4 4 0 00-5.478-5.478z" clip-rule="evenodd"/>
                      <path d="M12.454 16.697L9.75 13.992a4 4 0 01-3.742-3.741L2.335 6.578A9.98 9.98 0 00.458 10c1.274 4.057 5.065 7 9.542 7 .847 0 1.669-.105 2.454-.303z"/>
                    </svg>
                    <!-- Show icon (eye) - visible when checked -->
                    <svg class="absolute w-3 h-3 text-green-600 transition-opacity duration-200 opacity-0 peer-checked:opacity-100" viewBox="0 0 20 20" fill="currentColor">
                      <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"/>
                      <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"/>
                    </svg>
                  </div>
              </label>
            </div>

            <!-- Colorful Titles Setting -->
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-2">
                <div class="w-6 h-6 bg-gradient-to-br from-purple-500/20 to-pink-500/20 rounded-md flex items-center justify-center">
                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-purple-600 dark:text-purple-400">
                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                  </svg>
                </div>
                <div>
                  <div class="text-sm font-medium text-gray-800 dark:text-white">Colorful Titles</div>
                  <div class="text-xs text-gray-600 dark:text-gray-400">Gradient text effects</div>
                </div>
              </div>
              <label class="relative inline-flex items-center cursor-pointer">
                <input 
                  type="checkbox" 
                  id="mobileColorfulTitlesToggle" 
                  class="sr-only peer"
                  checked
                >
                <div class="relative w-10 h-5 bg-gray-200 dark:bg-gray-700 rounded-full peer-focus:ring-2 peer-focus:ring-purple-300/30 dark:peer-focus:ring-purple-800/30 transition-all duration-300 peer-checked:bg-gradient-to-r peer-checked:from-purple-500 peer-checked:to-pink-500 shadow-inner"></div>
                  <div class="absolute top-0.5 left-0.5 w-4 h-4 bg-white rounded-full shadow-lg transform transition-transform duration-300 peer-checked:translate-x-5"></div>
              </label>
            </div>
              </label>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>
</nav>

<style>
  /* Search bar apple gradient animation */
  #search-input.apple-gradient-active,
  #search-input-mobile.apple-gradient-active {
    background: linear-gradient(45deg, #0071e3, #ff4faa, #10d1ff);
    background-size: 200% 200%;
    animation: search-gradient-flow 3s ease-in-out infinite;
    border: 2px solid transparent;
    background-clip: padding-box;
    position: relative;
  }

  /* Search input border gradient effect - proper border gradient implementation */
  #search-input:focus,
  #search-input-mobile:focus {
    background: linear-gradient(var(--bg-light, rgba(0, 0, 0, 0.1)), var(--bg-light, rgba(0, 0, 0, 0.1))),
                linear-gradient(45deg, #0071e3, #ff4faa, #10d1ff);
    background-size: auto, 200% 200%;
    background-clip: padding-box, border-box;
    background-origin: border-box;
    border: 2px solid transparent;
    animation: search-gradient-flow 3s ease-in-out infinite;
    box-shadow: none !important;
  }

  /* Dark mode variant */
  :global(.dark) #search-input:focus,
  :global(.dark) #search-input-mobile:focus {
    background: linear-gradient(rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.1)),
                linear-gradient(45deg, #0071e3, #ff4faa, #10d1ff);
    background-size: auto, 200% 200%;
    background-clip: padding-box, border-box;
    background-origin: border-box;
  }

  #search-input.apple-gradient-active::before,
  #search-input-mobile.apple-gradient-active::before {
    content: '';
    position: absolute;
    inset: 0;
    padding: 2px;
    background: linear-gradient(45deg, #0071e3, #ff4faa, #10d1ff);
    background-size: 200% 200%;
    border-radius: inherit;
    mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    mask-composite: exclude;
    animation: search-gradient-flow 3s ease-in-out infinite;
    z-index: -1;
  }

  /* Search gradient animation keyframes */
  @keyframes search-gradient-flow {
    0% {
      background-position: 0% 50%;
    }
    25% {
      background-position: 100% 50%;
    }
    50% {
      background-position: 100% 50%;
    }
    75% {
      background-position: 0% 50%;
    }
    100% {
      background-position: 0% 50%;
    }
  }

  /* Disable search gradient animation when setting is off */
  .search-gradient-disabled #search-input.apple-gradient-active,
  .search-gradient-disabled #search-input-mobile.apple-gradient-active {
    animation: none !important;
    background: #0071e3 !important;
  }

  .search-gradient-disabled #search-input.apple-gradient-active::before,
  .search-gradient-disabled #search-input-mobile.apple-gradient-active::before {
    animation: none !important;
    background: #0071e3 !important;
  }

  /* Theme-aware gradient hover effects for navigation */
  .logo-gradient,
  .nav-gradient {
    background: linear-gradient(45deg, #10d1ff, #ff4faa);
    background-size: 300% 300%;
    -webkit-background-clip: text;
    background-clip: text;
    transition: all 0.5s ease;
  }

  .logo-gradient:hover,
  .nav-gradient:hover {
    background: linear-gradient(45deg, #0071e3, #ff4faa, #10d1ff);
    background-size: 200% 200%;
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: apple-gradient-flow 2s ease-in-out infinite;
  }

  /* Apple gradient flow animation for navigation */
  @keyframes apple-gradient-flow {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
  }

  /* Mobile Menu Styles */
  .mobile-nav-link {
    position: relative;
    display: block;
    overflow: hidden;
  }

  .mobile-nav-link::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 0;
    height: 2px;
    background: linear-gradient(45deg, #10d1ff, #ff4faa);
    transition: width 0.3s ease;
  }

  .mobile-nav-link:hover::after {
    width: 100%;
  }

  /* Mobile menu animations */
  #mobile-menu.menu-open {
    transform: translateX(0);
  }

  /* Hamburger icon animation */
  #mobile-menu-toggle .hamburger-icon,
  #mobile-menu-toggle .close-icon {
    transition: opacity 0.2s ease;
  }

  #mobile-menu-toggle[aria-expanded="true"] .hamburger-icon {
    opacity: 0;
  }

  #mobile-menu-toggle[aria-expanded="true"] .close-icon {
    opacity: 1;
  }

  #mobile-menu-toggle[aria-expanded="false"] .close-icon {
    opacity: 0;
  }

  /* Responsive navigation styles */
  @media (max-width: 1111px) {
    /* Remove column direction for mobile layout */
    .nav-search {
      @apply mx-0;
    }
    .search-input {
      @apply min-w-64;
    }
  }

  /* Custom flex-2 utility for mobile navigation */
  .flex-grow-2 {
    flex: 2 1 0%;
  }
</style>

<script define:vars={{ animationConfig }}>
  // NavBar script initialization (debug removed for production)
  // Mobile menu functionality starts here
  
  // Search input apple gradient animation
  function initSearchAnimation() {
    if (!animationConfig.searchGradientEnabled) {
      return;
    }

    const searchInput = document.getElementById('search-input');
    const searchInputMobile = document.getElementById('search-input-mobile');
    
    [searchInput, searchInputMobile].forEach(input => {
      if (!input) return;

      // Add gradient on focus
      const addGradient = () => {
        input.classList.add('apple-gradient-active');
      };

      // Remove gradient
      const removeGradient = () => {
        input.classList.remove('apple-gradient-active');
      };

      // Event listeners
      input.addEventListener('focus', addGradient);
      input.addEventListener('blur', removeGradient);
    });
    
    // Remove gradient on scroll (user is moving away)
    let scrollTimeout;
    const handleScroll = () => {
      [searchInput, searchInputMobile].forEach(input => {
        if (input && input.classList.contains('apple-gradient-active')) {
          clearTimeout(scrollTimeout);
          scrollTimeout = setTimeout(() => input.classList.remove('apple-gradient-active'), animationConfig.searchScrollDelay);
        }
      });
    };
    
    window.addEventListener('scroll', handleScroll, { passive: true });

    // Apply animation settings
    const body = document.body;
    if (!animationConfig.searchGradientEnabled) {
      body.classList.add('search-gradient-disabled');
    } else {
      body.classList.remove('search-gradient-disabled');
    }
  }

  // Mobile menu functionality
  function initMobileMenu() {
    // Mobile menu initialization (debug removed for production)
    const menuToggle = document.getElementById('mobile-menu-toggle');
    const mobileMenu = document.getElementById('mobile-menu');
    const mobileMenuClose = document.getElementById('mobile-menu-close');
    const mobileNavLinks = document.querySelectorAll('.mobile-nav-link');
    
    // Menu elements validation
    
    if (!menuToggle || !mobileMenu) {
      // Mobile menu elements not found - fail silently in production
      return;
    }

    let isMenuOpen = false;

    // Mobile settings tracking
    let userHasClosedSettings = false;
    let isFirstMenuOpen = true;

    const openMenu = () => {

      isMenuOpen = true;
      mobileMenu.classList.add('menu-open');
      menuToggle.setAttribute('aria-expanded', 'true');
      menuToggle.querySelector('.hamburger-icon').classList.add('hidden');
      menuToggle.querySelector('.close-icon').classList.remove('hidden');
      document.body.style.overflow = 'hidden'; // Prevent body scroll
      
      // Mobile settings auto-open logic
      const mobileSettingsPanel = document.getElementById('mobileSettingsPanel');
      const settingsChevron = document.getElementById('settingsChevron');
      
      if (mobileSettingsPanel && settingsChevron) {
        if (isFirstMenuOpen && !userHasClosedSettings) {
          // First time opening - auto open settings
          mobileSettingsPanel.classList.remove('hidden');
          settingsChevron.style.transform = 'rotate(180deg)';
          isFirstMenuOpen = false;
        }
        // Subsequent opens - keep current state unless user manually closed it
      }
      
      // Hide the floating dock when mobile menu is open
      const floatingDock = document.getElementById('floatingDock');
      if (floatingDock) {
        floatingDock.classList.add('translate-y-full', 'opacity-0');
        floatingDock.classList.remove('translate-y-0', 'opacity-100');
      }
    };

    const closeMenu = () => {

      isMenuOpen = false;
      mobileMenu.classList.remove('menu-open');
      menuToggle.setAttribute('aria-expanded', 'false');
      menuToggle.querySelector('.hamburger-icon').classList.remove('hidden');
      menuToggle.querySelector('.close-icon').classList.add('hidden');
      document.body.style.overflow = ''; // Restore body scroll
      
      // Always close settings panel when mobile menu closes
      const mobileSettingsPanel = document.getElementById('mobileSettingsPanel');
      const settingsChevron = document.getElementById('settingsChevron');
      
      if (mobileSettingsPanel && settingsChevron) {
        mobileSettingsPanel.classList.add('hidden');
        settingsChevron.style.transform = 'rotate(0deg)';
      }
      
      // Show the floating dock when mobile menu is closed (only if not at top of page)
      const floatingDock = document.getElementById('floatingDock');
      const topNav = document.getElementById('topNav');
      if (floatingDock && topNav) {
        // Check if top nav is visible to determine if dock should be shown
        const topNavRect = topNav.getBoundingClientRect();
        const isTopNavVisible = topNavRect.top >= -10; // Small threshold for intersection
        
        if (!isTopNavVisible) {
          // Only show dock if user has scrolled down
          floatingDock.classList.remove('translate-y-full', 'opacity-0');
          floatingDock.classList.add('translate-y-0', 'opacity-100');
        }
      }
    };

    // Make settings state tracking available to settings toggle
    window.mobileSettingsState = {
      setUserClosed: (closed) => { userHasClosedSettings = closed; }
    };

    // Toggle menu on button click
    menuToggle.addEventListener('click', (e) => {

      if (isMenuOpen) {
        closeMenu();
      } else {
        openMenu();
      }
    });

    // Close menu on close button click
    if (mobileMenuClose) {
      mobileMenuClose.addEventListener('click', closeMenu);
    }

    // Close menu when clicking on navigation links
    mobileNavLinks.forEach(link => {
      link.addEventListener('click', closeMenu);
    });

    // Add swipe gesture support to close mobile menu
    let touchStartX = 0;
    let touchStartY = 0;
    let touchEndX = 0;
    let touchEndY = 0;
    const minSwipeDistance = 100;
    const maxVerticalDistance = 100;

    const handleTouchStart = (e) => {
      if (!isMenuOpen) return;
      touchStartX = e.touches[0].clientX;
      touchStartY = e.touches[0].clientY;
    };

    const handleTouchMove = (e) => {
      if (!isMenuOpen) return;
      
      const currentX = e.touches[0].clientX;
      const swipeDistance = currentX - touchStartX;
      
      // Add visual feedback during swipe
      const mobileMenuContent = mobileMenu.querySelector('div:last-child');
      if (mobileMenuContent && swipeDistance > 0) {
        // Apply subtle transform during right swipe
        const transform = Math.min(swipeDistance * 0.2, 20); // Limit to 20px
        mobileMenuContent.style.transform = `translateX(${transform}px)`;
      }
      
      // Prevent default to avoid scrolling during swipe
      e.preventDefault();
    };

    const handleTouchEnd = (e) => {
      if (!isMenuOpen) return;
      touchEndX = e.changedTouches[0].clientX;
      touchEndY = e.changedTouches[0].clientY;

      const swipeDistanceX = touchEndX - touchStartX;
      const swipeDistanceY = Math.abs(touchEndY - touchStartY);

      // Reset transform
      const mobileMenuContent = mobileMenu.querySelector('div:last-child');
      if (mobileMenuContent) {
        mobileMenuContent.style.transform = '';
      }

      // Detect right swipe (positive X distance) with minimal vertical movement
      if (swipeDistanceX > minSwipeDistance && swipeDistanceY < maxVerticalDistance) {
        closeMenu();
      }
    };

    // Close menu when clicking outside (on backdrop)
    const mobileMenuBackdrop = document.getElementById('mobile-menu-backdrop');
    if (mobileMenuBackdrop) {
      mobileMenuBackdrop.addEventListener('click', (e) => {
        closeMenu();
      });

      // Also add swipe gesture to backdrop for better UX
      mobileMenuBackdrop.addEventListener('touchstart', handleTouchStart, { passive: true });
      mobileMenuBackdrop.addEventListener('touchmove', handleTouchMove, { passive: false });
      mobileMenuBackdrop.addEventListener('touchend', handleTouchEnd, { passive: true });
    }

    // Also handle clicks on the menu overlay itself
    mobileMenu.addEventListener('click', (e) => {
      // Only close if clicking directly on the menu overlay (not on menu content)
      if (e.target === mobileMenu) {

        closeMenu();
      }
    });

    // Close menu on escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && isMenuOpen) {
        closeMenu();
      }
    });

    // Close menu on window resize to desktop
    window.addEventListener('resize', () => {
      if (window.innerWidth >= 1111 && isMenuOpen) {
        closeMenu();
      }
    });

    // Add touch event listeners to the mobile menu content
    const mobileMenuContent = mobileMenu.querySelector('div:last-child'); // The menu content div
    if (mobileMenuContent) {
      mobileMenuContent.addEventListener('touchstart', handleTouchStart, { passive: true });
      mobileMenuContent.addEventListener('touchmove', handleTouchMove, { passive: false });
      mobileMenuContent.addEventListener('touchend', handleTouchEnd, { passive: true });
    }

    // Connect mobile settings toggles to main settings functionality
    const mobileThemeToggle = document.getElementById('mobileThemeToggle');
    const mobileMarqueeToggle = document.getElementById('mobileMarqueeToggle');
    const mobileColorfulTitlesToggle = document.getElementById('mobileColorfulTitlesToggle');
    
    // Connect to main settings toggles (if they exist)
    const mainThemeToggle = document.getElementById('themeToggle');
    const mainMarqueeToggle = document.getElementById('marqueeToggle');
    const mainColorfulTitlesToggle = document.getElementById('colorfulTitlesToggle');

    // Sync mobile theme toggle
    if (mobileThemeToggle && mainThemeToggle) {
      // Sync initial state
      mobileThemeToggle.checked = mainThemeToggle.checked;
      
      mobileThemeToggle.addEventListener('change', () => {
        mainThemeToggle.checked = mobileThemeToggle.checked;
        mainThemeToggle.dispatchEvent(new Event('change'));

      });
    }

    // Sync mobile marquee toggle
    if (mobileMarqueeToggle && mainMarqueeToggle) {
      // Sync initial state
      mobileMarqueeToggle.checked = mainMarqueeToggle.checked;
      
      mobileMarqueeToggle.addEventListener('change', () => {
        mainMarqueeToggle.checked = mobileMarqueeToggle.checked;
        mainMarqueeToggle.dispatchEvent(new Event('change'));

      });
    }

    // Sync mobile colorful titles toggle
    if (mobileColorfulTitlesToggle && mainColorfulTitlesToggle) {
      // Sync initial state
      mobileColorfulTitlesToggle.checked = mainColorfulTitlesToggle.checked;
      
      mobileColorfulTitlesToggle.addEventListener('change', () => {
        mainColorfulTitlesToggle.checked = mobileColorfulTitlesToggle.checked;
        mainColorfulTitlesToggle.dispatchEvent(new Event('change'));

      });
    }

  }

  // Developer utility - accessible from browser console
  if (!window.MannyKnowsNavigation) {
    window.MannyKnowsNavigation = {
      searchAnimation: {
        config: animationConfig,
        toggle: () => {
          animationConfig.searchGradientEnabled = !animationConfig.searchGradientEnabled;

        },
        status: () => {
          console.table(animationConfig);
        }
      },
      mobileMenu: {
        open: () => document.getElementById('mobile-menu-toggle')?.click(),
        close: () => {
          const menu = document.getElementById('mobile-menu');
          if (menu && menu.classList.contains('menu-open')) {
            document.getElementById('mobile-menu-toggle')?.click();
          }
        }
      }
    };
  }

  // Mobile Settings Panel Initialization
  function initMobileSettings() {

    // Immediate check

    const mobileSettingsToggle = document.getElementById('mobileSettingsToggle');
    const mobileSettingsPanel = document.getElementById('mobileSettingsPanel');
    const settingsChevron = document.getElementById('settingsChevron');

    if (mobileSettingsToggle && mobileSettingsPanel && settingsChevron) {

      // Settings toggle event listener
      mobileSettingsToggle.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        
        const isHidden = mobileSettingsPanel.classList.contains('hidden');
        
        if (isHidden) {
          // Show settings panel
          mobileSettingsPanel.classList.remove('hidden');
          settingsChevron.style.transform = 'rotate(180deg)';
          // User opened it manually
          if (window.mobileSettingsState) {
            window.mobileSettingsState.setUserClosed(false);
          }
        } else {
          // Hide settings panel
          mobileSettingsPanel.classList.add('hidden');
          settingsChevron.style.transform = 'rotate(0deg)';
          // User closed it manually
          if (window.mobileSettingsState) {
            window.mobileSettingsState.setUserClosed(true);
          }
        }
      });

    } else {
      // Try with timeout
      setTimeout(() => {
        const mobileSettingsToggle2 = document.getElementById('mobileSettingsToggle');
        const mobileSettingsPanel2 = document.getElementById('mobileSettingsPanel');
        const settingsChevron2 = document.getElementById('settingsChevron');

        if (mobileSettingsToggle2 && mobileSettingsPanel2 && settingsChevron2) {
          
          mobileSettingsToggle2.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            
            const isHidden = mobileSettingsPanel2.classList.contains('hidden');
            
            if (isHidden) {
              mobileSettingsPanel2.classList.remove('hidden');
              settingsChevron2.style.transform = 'rotate(180deg)';
              if (window.mobileSettingsState) {
                window.mobileSettingsState.setUserClosed(false);
              }
            } else {
              mobileSettingsPanel2.classList.add('hidden');
              settingsChevron2.style.transform = 'rotate(0deg)';
              if (window.mobileSettingsState) {
                window.mobileSettingsState.setUserClosed(true);
              }
            }
          });
        }
      }, 500);
    }
  }

  // Initialize when DOM is ready
  document.addEventListener('DOMContentLoaded', () => {
    initSearchAnimation();
    initMobileMenu();
    initMobileSettings(); // Add separate initialization
  }, { passive: true });
</script>
