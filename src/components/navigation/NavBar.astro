---
import Button from '../ui/Button.astro';

interface AnimationConfig {
  searchGradientEnabled?: boolean;
  debugMode?: boolean;
  searchScrollDelay?: number;
}

interface Props {
  className?: string;
  animationConfig?: AnimationConfig;
}

const { 
  className = "",
  animationConfig = {
    searchGradientEnabled: true,
    debugMode: false,
    searchScrollDelay: 0
  }
} = Astro.props;

const navLinks = [
  { href: "#services", label: "Services" },
  { href: "#products", label: "Products" },
  { href: "#process", label: "Process" },
  { href: "#reviews", label: "Reviews" },
];
---

<nav id="topNav" class={`bg-transparent min-h-[7.75rem] relative flex items-center border-b border-gray-300/30 dark:border-white/10 ${className}`}>
  <div class="max-w-[1440px] mx-auto px-8 w-full">
    <div class="flex justify-between items-center w-full">
      <!-- Logo -->
      <h1 class="text-5xl font-black m-0">
        <a href="/" class="logo-gradient text-text-light-primary dark:text-text-dark-primary font-black transition-all duration-500 hover:-translate-y-1 hover:scale-105 no-underline relative overflow-hidden before:content-[''] before:absolute before:inset-0 before:bg-gradient-to-r before:from-transparent before:via-white/6 before:to-transparent before:-translate-x-full before:animate-subtle-shimmer before:pointer-events-none">
          MK
        </a>
      </h1>

      <!-- Navigation Menu -->
      <ul class="flex list-none gap-8 m-0 p-0 flex-1 justify-center ml-8">
        {navLinks.map((link) => (
          <li>
            <a
              href={link.href}
              class="nav-gradient text-text-light-primary dark:text-text-dark-primary font-medium transition-all duration-500 hover:-translate-y-1 no-underline relative overflow-hidden before:content-[''] before:absolute before:inset-0 before:bg-gradient-to-r before:from-transparent before:via-white/6 before:to-transparent before:-translate-x-full before:animate-subtle-shimmer before:pointer-events-none"
            >
              {link.label}
            </a>
          </li>
        ))}
      </ul>

      <!-- Search Bar -->
      <div class="relative flex items-center flex-1 mx-4">
        <label for="search-input" class="sr-only">Browse Services Catalog</label>
        <input
          id="search-input"
          type="search"
          placeholder="Browse services catalog..."
          class="bg-black/10 dark:bg-white/10 border border-border-light dark:border-border-dark rounded-lg py-3 pl-4 pr-10 text-text-light-primary dark:text-text-dark-primary text-sm w-full h-12 transition-all duration-300 backdrop-blur-lg placeholder:text-text-light-tertiary dark:placeholder:text-text-dark-tertiary focus:outline-none focus:border-primary-blue/50 focus:bg-black/20 dark:focus:bg-white/20 focus:shadow-[0_0_0_2px_rgba(16,209,255,0.2)]"
        />
        <button type="button" class="absolute right-2 bg-none border-none text-text-light-tertiary dark:text-text-dark-tertiary cursor-pointer p-1 rounded transition-colors duration-300 flex items-center justify-center hover:text-text-light-primary dark:hover:text-text-dark-primary" aria-label="Search">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
        </button>
      </div>

      <!-- Navigation Actions -->
      <div class="flex items-center gap-2 relative">
        <Button
          href="#instant-quote"
          text="FREE 360 PHOTO"
          subtext="CLAIM NOW"
          id="instant-quote-btn"
          variant="theme-aware"
        />

        <Button
          href="#apple-quote"
          text="FREE WEBSITE"
          subtext="EXPIRING SOON"
          variant="emoji"
          emoji="ðŸš€"
          emojiAnimation="subtle"
          sparkles={false}
          className="text-[10px] text-white/80 leading-none"
        />

        <button type="button" class="group bg-gradient-to-br from-green-500 via-emerald-500 to-green-600 bg-200 border border-green-400/30 rounded-lg text-white w-12 h-12 flex items-center justify-center cursor-pointer transition-all duration-300 relative overflow-hidden hover:scale-105 hover:shadow-[0_8px_25px_rgba(34,197,94,0.4)] animate-green-gradient-flow before:content-[''] before:absolute before:inset-0 before:bg-gradient-to-r before:from-transparent before:via-white/8 before:to-transparent before:-translate-x-full before:animate-green-shimmer" id="topChatToggle">
          <pixel-canvas data-colors="#ffffff, #f8fafc, #e2e8f0" data-gap="4" data-speed="60" data-no-focus style="position: absolute; inset: 0; z-index: 1; pointer-events: none;"></pixel-canvas>
          <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="relative z-10">
            <path d="M12 8V4H8"/>
            <rect width="16" height="12" x="4" y="8" rx="2"/>
            <path d="M2 14h2"/>
            <path d="M20 14h2"/>
            <path d="M15 13v2"/>
            <path d="M9 13v2"/>
          </svg>
          <!-- Tooltip -->
          <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-black dark:bg-white text-white dark:text-black text-sm whitespace-nowrap rounded opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50 shadow-lg pointer-events-none" role="tooltip">
            Talk to Us
          </div>
        </button>
      </div>
    </div>
  </div>
</nav>

<style>
  /* Search bar apple gradient animation */
  #search-input.apple-gradient-active {
    background: linear-gradient(45deg, #0071e3, #ff4faa, #10d1ff);
    background-size: 200% 200%;
    animation: search-gradient-flow 3s ease-in-out infinite;
    border: 2px solid transparent;
    background-clip: padding-box;
    position: relative;
  }

  #search-input.apple-gradient-active::before {
    content: '';
    position: absolute;
    inset: 0;
    padding: 2px;
    background: linear-gradient(45deg, #0071e3, #ff4faa, #10d1ff);
    background-size: 200% 200%;
    border-radius: inherit;
    mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    mask-composite: exclude;
    animation: search-gradient-flow 3s ease-in-out infinite;
    z-index: -1;
  }

  /* Search gradient animation keyframes */
  @keyframes search-gradient-flow {
    0% {
      background-position: 0% 50%;
    }
    25% {
      background-position: 100% 50%;
    }
    50% {
      background-position: 100% 50%;
    }
    75% {
      background-position: 0% 50%;
    }
    100% {
      background-position: 0% 50%;
    }
  }

  /* Disable search gradient animation when setting is off */
  .search-gradient-disabled #search-input.apple-gradient-active {
    animation: none !important;
    background: #0071e3 !important;
  }

  .search-gradient-disabled #search-input.apple-gradient-active::before {
    animation: none !important;
    background: #0071e3 !important;
  }

  /* Theme-aware gradient hover effects for navigation */
  .logo-gradient,
  .nav-gradient {
    background: linear-gradient(45deg, #10d1ff, #ff4faa);
    background-size: 300% 300%;
    -webkit-background-clip: text;
    background-clip: text;
    transition: all 0.5s ease;
  }

  .logo-gradient:hover,
  .nav-gradient:hover {
    background: linear-gradient(45deg, #0071e3, #ff4faa, #10d1ff);
    background-size: 200% 200%;
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: apple-gradient-flow 2s ease-in-out infinite;
  }

  /* Apple gradient flow animation for navigation */
  @keyframes apple-gradient-flow {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
  }

  /* Responsive navigation styles */
  @media (max-width: 768px) {
    nav .flex {
      @apply flex-col gap-4;
    }
    nav ul {
      @apply gap-6 flex-wrap justify-center;
    }
    .nav-search {
      @apply mx-0 order-1;
    }
    .search-input {
      @apply w-80 min-w-64;
    }
    .nav-actions {
      @apply -order-1 gap-3;
    }
  }
</style>

<script define:vars={{ animationConfig }}>
  // Search input apple gradient animation
  function initSearchAnimation() {
    if (!animationConfig.searchGradientEnabled) {
      if (animationConfig.debugMode) console.log('Search gradient animation disabled');
      return;
    }

    const searchInput = document.getElementById('search-input');
    if (!searchInput) return;

    if (animationConfig.debugMode) console.log('Search gradient animation enabled');

    // Add gradient on focus
    const addGradient = () => {
      searchInput.classList.add('apple-gradient-active');
      if (animationConfig.debugMode) console.log('Search gradient activated');
    };

    // Remove gradient
    const removeGradient = () => {
      searchInput.classList.remove('apple-gradient-active');
      if (animationConfig.debugMode) console.log('Search gradient deactivated');
    };

    // Event listeners
    searchInput.addEventListener('focus', addGradient);
    searchInput.addEventListener('blur', removeGradient);
    
    // Remove gradient on scroll (user is moving away)
    let scrollTimeout;
    const handleScroll = () => {
      if (searchInput.classList.contains('apple-gradient-active')) {
        clearTimeout(scrollTimeout);
        scrollTimeout = setTimeout(removeGradient, animationConfig.searchScrollDelay);
      }
    };
    
    window.addEventListener('scroll', handleScroll, { passive: true });

    // Apply animation settings
    const body = document.body;
    if (!animationConfig.searchGradientEnabled) {
      body.classList.add('search-gradient-disabled');
      if (animationConfig.debugMode) console.log('Search gradient disabled via CSS class');
    } else {
      body.classList.remove('search-gradient-disabled');
    }
  }

  // Developer utility - accessible from browser console
  if (!window.MannyKnowsNavigation) {
    window.MannyKnowsNavigation = {
      searchAnimation: {
        config: animationConfig,
        toggle: () => {
          animationConfig.searchGradientEnabled = !animationConfig.searchGradientEnabled;
          console.log(`Search gradient: ${animationConfig.searchGradientEnabled ? 'enabled' : 'disabled'}`);
          console.log('Refresh page to see changes');
        },
        status: () => {
          console.table(animationConfig);
        }
      }
    };
  }

  // Initialize when DOM is ready
  document.addEventListener('DOMContentLoaded', () => {
    initSearchAnimation();
  }, { passive: true });
</script>
