---
import DockButton from '../ui/DockButton.astro';
---

<!-- Floating Dock Menu -->
<div id="floatingDock" class="fixed bottom-3 left-1/2 transform -translate-x-1/2 z-50 transition-all duration-500 ease-out sm:w-auto w-full max-w-none px-2 sm:px-0">
    <div class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-xl border border-gray-300/40 dark:border-white/20 rounded-xl sm:rounded-2xl p-1.5 sm:p-2.5 shadow-[0_20px_60px_rgba(0,0,0,0.15)] dark:shadow-[0_20px_60px_rgba(0,0,0,0.4)]">
    <div class="flex items-center justify-center gap-2">
      <!-- MK Logo -->
      <DockButton 
        tooltip="Home" 
        icon="MK"
        onClick="window.location.href='/'"
        variant="brand"
      />

      <!-- Services -->
      <DockButton 
        tooltip="Services" 
        icon={`<svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="7" height="7"/>
          <rect x="14" y="3" width="7" height="7"/>
          <rect x="14" y="14" width="7" height="7"/>
          <rect x="3" y="14" width="7" height="7"/>
        </svg>`}
        onClick="document.getElementById('services').scrollIntoView({behavior: 'smooth'})"
      />

      <!-- Products -->
      <DockButton 
        tooltip="Products" 
        icon={`<svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/>
          <line x1="3" y1="6" x2="21" y2="6"/>
          <path d="M16 10a4 4 0 0 1-8 0"/>
        </svg>`}
        onClick="document.getElementById('products').scrollIntoView({behavior: 'smooth'})"
      />

      <!-- Process -->
      <DockButton 
        tooltip="Process" 
        icon={`<svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="9,11 12,14 22,4"/>
          <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
        </svg>`}
        onClick="document.getElementById('process').scrollIntoView({behavior: 'smooth'})"
      />

      <!-- Reviews -->
      <DockButton 
        tooltip="Reviews" 
        icon={`<svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
        </svg>`}
        onClick="document.getElementById('reviews').scrollIntoView({behavior: 'smooth'})"
      />

      <!-- Chat -->
      <DockButton 
        tooltip="Chat" 
        icon={`<svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 8V4H8"/>
          <rect width="16" height="12" x="4" y="8" rx="2"/>
          <path d="M2 14h2"/>
          <path d="M20 14h2"/>
          <path d="M15 13v2"/>
          <path d="M9 13v2"/>
        </svg>`}
        variant="chat"
        id="dockChatToggle"
      />

      <!-- Divider -->
      <div class="w-px h-6 sm:h-8 bg-gradient-to-b from-transparent via-gray-400/30 dark:via-white/20 to-transparent md:hidden"></div>

      <!-- Hamburger Menu -->
      <DockButton 
        tooltip="Menu" 
        icon={`<svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <line x1="3" y1="12" x2="21" y2="12"></line>
          <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>`}
        id="dockMenuToggle"
        className="md:hidden"
      />
    </div>
  </div>
</div>

<style>
  /* Dock hover effects */
  .dock-item:hover {
    transform: translateY(-4px) scale(1.1);
  }

  /* Simple responsive positioning */
  @media (max-width: 640px) {
    #floatingDock {
      bottom: 0.5rem;
    }
  }
</style>

<script>
  // Enhanced dock visibility and functionality
  function initDockVisibility() {
    const topNav = document.getElementById('topNav');
    const floatingDock = document.getElementById('floatingDock');

    if (!topNav || !floatingDock) {
      // Show dock by default if elements aren't found
      if (floatingDock) {
        setTimeout(() => {
          floatingDock.classList.remove('translate-y-full', 'opacity-0');
          floatingDock.classList.add('translate-y-0', 'opacity-100');
        }, 1000);
      }
      return;
    }

    // Initially hide the dock
    floatingDock.classList.add('translate-y-full', 'opacity-0');
    
    // Create intersection observer to show/hide dock based on nav visibility
    const observer = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          // Top nav visible → hide dock (user is at top of page)
          floatingDock.classList.add('translate-y-full', 'opacity-0');
          floatingDock.classList.remove('translate-y-0', 'opacity-100');
        } else {
          // Top nav hidden → show dock (user has scrolled down)
          floatingDock.classList.remove('translate-y-full', 'opacity-0');
          floatingDock.classList.add('translate-y-0', 'opacity-100');
        }
      });
    }, {
      threshold: 0.1,
      rootMargin: '-10px 0px'
    });

    observer.observe(topNav);

    // Connect dock chat button to main chat functionality
    const dockChatToggle = document.getElementById('dockChatToggle');
    if (dockChatToggle) {
      // Remove the redirect to mainChatToggle, let ChatBox handle it directly
      // The ChatBox component already listens for dockChatToggle clicks
    }

    // Connect dock hamburger menu to main mobile menu
    const dockMenuToggle = document.getElementById('dockMenuToggle');
    const mainMenuToggle = document.getElementById('mobile-menu-toggle');
    if (dockMenuToggle && mainMenuToggle) {
      dockMenuToggle.addEventListener('click', () => {

        mainMenuToggle.click();
      });
    }
  }

  // Initialize when DOM is loaded
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initDockVisibility, { passive: true });
  } else {
    initDockVisibility();
  }
  
  // Fallback: Show dock after a delay if initialization doesn't work
  setTimeout(() => {
    const floatingDock = document.getElementById('floatingDock');
    if (floatingDock && floatingDock.classList.contains('translate-y-full')) {

      floatingDock.classList.remove('translate-y-full', 'opacity-0');
      floatingDock.classList.add('translate-y-0', 'opacity-100');
    }
  }, 3000);
</script>