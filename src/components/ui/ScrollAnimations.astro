---
/**
 * ScrollAnimations Component
 * 
 * A wrapper component that adds scroll-triggered animations to any child content.
 * Uses Intersection Observer for performance and respects user accessibility preferences.
 * 
 * Usage:
 * <ScrollAnimations animation="fadeIn" delay={200}>
 *   <YourComponent />
 * </ScrollAnimations>
 */

interface Props {
  /** Animation mode: trigger (animate once), scroll (continuous), or custom (complex choreographed) */
  mode?: 'trigger' | 'scroll' | 'custom';
  /** Animation type for trigger mode */
  animation?: 'fadeIn' | 'slideInLeft' | 'slideInRight' | 'slideInUp' | 'slideInDown' | 'scaleIn' | 'none';
  /** Scroll effect for scroll mode */
  scrollEffect?: 'parallax' | 'rotate' | 'scale' | 'opacity' | 'skew' | 'blur';
  /** Custom animation name for custom mode */
  customAnimation?: string;
  /** Configuration object for custom animations */
  animationConfig?: Record<string, any>;
  /** Whether this section's animation is enabled */
  enabled?: boolean;
  /** Delay before animation starts (ms) - trigger mode only */
  delay?: number;
  /** Animation duration (ms) - trigger mode only */
  duration?: number;
  /** Distance from viewport when animation triggers (0-1) */
  threshold?: number;
  /** Whether to animate only once or every time element enters viewport - trigger mode only */
  once?: boolean;
  /** Scroll speed multiplier for parallax effect (0.1 = slow, 2.0 = fast) */
  scrollSpeed?: number;
  /** Start value for scroll animations */
  startValue?: number;
  /** End value for scroll animations */
  endValue?: number;
  /** Additional CSS classes */
  className?: string;
  /** Enable debug logging */
  debug?: boolean;
}

const {
  mode = 'trigger',
  animation = 'fadeIn',
  scrollEffect = 'parallax',
  customAnimation = '',
  animationConfig = {},
  enabled = true,
  delay = 0,
  duration = 600,
  threshold = 0.1,
  once = true,
  scrollSpeed = 0.5,
  startValue = 0,
  endValue = 100,
  className = '',
  debug = false
} = Astro.props;

// Generate unique ID for this animation element
const animationId = `scroll-anim-${Math.random().toString(36).substr(2, 9)}`;
---

<div 
  id={animationId}
  class={`scroll-animation-wrapper ${mode === 'trigger' ? animation : scrollEffect} ${className}`}
  data-mode={mode}
  data-animation={animation}
  data-scroll-effect={scrollEffect}
  data-custom-animation={customAnimation}
  data-animation-config={JSON.stringify(animationConfig)}
  data-enabled={enabled}
  data-delay={delay}
  data-duration={duration}
  data-threshold={threshold}
  data-once={once}
  data-scroll-speed={scrollSpeed}
  data-start-value={startValue}
  data-end-value={endValue}
  data-debug={debug}
>
  <slot />
</div>

<style>
  /* Base animation wrapper */
  .scroll-animation-wrapper {
    transition-property: opacity, transform;
    transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
  }

  /* TRIGGER MODE: Initial hidden states - Made more dramatic for visibility */
  .scroll-animation-wrapper.fadeIn {
    opacity: 0;
  }

  .scroll-animation-wrapper.slideInLeft {
    opacity: 0;
    transform: translateX(-100px); /* Increased from -50px */
  }

  .scroll-animation-wrapper.slideInRight {
    opacity: 0;
    transform: translateX(100px); /* Increased from 50px */
  }

  .scroll-animation-wrapper.slideInUp {
    opacity: 0;
    transform: translateY(100px); /* Increased from 50px */
  }

  .scroll-animation-wrapper.slideInDown {
    opacity: 0;
    transform: translateY(-100px); /* Increased from -50px */
  }

  .scroll-animation-wrapper.scaleIn {
    opacity: 0;
    transform: scale(0.5); /* Reduced from 0.8 for more dramatic effect */
  }

  /* TRIGGER MODE: Animated states */
  .scroll-animation-wrapper.animate {
    opacity: 1;
    transform: translateX(0) translateY(0) scale(1);
  }

  /* SCROLL MODE: Base styles for continuous animations */
  .scroll-animation-wrapper.parallax,
  .scroll-animation-wrapper.rotate,
  .scroll-animation-wrapper.scale,
  .scroll-animation-wrapper.opacity,
  .scroll-animation-wrapper.skew,
  .scroll-animation-wrapper.blur {
    /* Styles will be applied dynamically via JavaScript */
    will-change: transform, opacity, filter;
  }

  /* Respect reduced motion preferences */
  @media (prefers-reduced-motion: reduce) {
    .scroll-animation-wrapper {
      transition: none !important;
      opacity: 1 !important;
      transform: none !important;
      filter: none !important;
      will-change: auto !important;
    }
  }
</style>
