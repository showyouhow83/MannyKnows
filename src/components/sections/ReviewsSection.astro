---
import ReviewCard from '../ui/ReviewCard.astro';
import Section from '../layout/Section.astro';
import Container from '../layout/Container.astro';
import SectionHeader from '../ui/SectionHeader.astro';
import StatsCard from '../ui/StatsCard.astro';
import Button from '../ui/Button.astro';

// Reviews data
const reviews = [
  {
    customerName: "Sarah Chen",
    testimonial: "MannyKnows transformed our online store completely. Our conversion rates increased by 340% within 3 months, and the AI automation saves us 20+ hours weekly.",
    tags: [
      { label: "AI E-commerce", color: "blue" as const },
      { label: "Automation", color: "purple" as const },
      { label: "Analytics", color: "pink" as const }
    ]
  },
  {
    customerName: "Marcus Rodriguez",
    testimonial: "The product photography service is incredible. Our product pages look professional and sales have doubled. The team understands e-commerce visual needs perfectly.",
    tags: [
      { label: "Photography", color: "green" as const },
      { label: "Product Visuals", color: "blue" as const },
      { label: "Brand Design", color: "purple" as const }
    ]
  },
  {
    customerName: "Emily Watson",
    testimonial: "Custom AI integration revolutionized our customer support. Response time dropped 90% while satisfaction scores hit all-time highs. Exceptional technical expertise.",
    tags: [
      { label: "AI Integration", color: "purple" as const },
      { label: "Customer Support", color: "blue" as const },
      { label: "Automation", color: "green" as const }
    ]
  },
  {
    customerName: "David Kim",
    testimonial: "Our new website is blazing fast and converts like crazy. Mobile sales jumped 280% and our SEO rankings skyrocketed. Best investment we've made!",
    tags: [
      { label: "Web Development", color: "blue" as const },
      { label: "SEO", color: "green" as const },
      { label: "Mobile Optimization", color: "purple" as const }
    ]
  },
  {
    customerName: "Lisa Thompson",
    testimonial: "The social media automation is phenomenal. Our engagement tripled and we're generating 5x more qualified leads. The analytics insights are game-changing.",
    tags: [
      { label: "Social Media", color: "pink" as const },
      { label: "Automation", color: "purple" as const },
      { label: "Lead Generation", color: "blue" as const }
    ]
  },
  {
    customerName: "Robert Chen",
    testimonial: "Analytics & reporting gave us crystal clear insights into customer behavior. We optimized our funnel and saw a 420% increase in lifetime value!",
    tags: [
      { label: "Analytics", color: "blue" as const },
      { label: "Reporting", color: "purple" as const },
      { label: "Optimization", color: "green" as const }
    ]
  },
  {
    customerName: "Amanda Foster",
    testimonial: "The content creation service transformed our brand voice. Blog traffic increased 6x and we're now ranking #1 for our main keywords. Outstanding quality and strategy.",
    tags: [
      { label: "Content Creation", color: "blue" as const },
      { label: "SEO Content", color: "green" as const },
      { label: "Brand Strategy", color: "purple" as const }
    ]
  }
];

// Stats data
const stats = [
  { value: "4+", label: "Happy Clients" },
  { value: "135%", label: "Avg. Sales Increase" },
  { value: "100%", label: "Client Satisfaction" },
  { value: "24/7", label: "Human Support" }
];
---

<Section id="reviews" variant="default" hasOverflow={true}>
  <Container className="relative z-10">
    <SectionHeader
      title="Customer Success Stories"
      subtitle="Discover how businesses like yours achieved remarkable growth with our AI-powered e-commerce solutions."
    />

    <!-- Reviews Carousel Container -->
    <div class="relative mb-12">

      <!-- Reviews Container -->
      <div class="py-4">
        <!-- Mobile: Single card view -->
        <div class="block md:hidden px-8">
          <div id="reviewsContainerMobile" class="flex transition-transform duration-500 ease-in-out">
            {reviews.map((review) => (
              <div class="w-full flex-shrink-0 px-2">
                <div class="bg-white/80 dark:bg-white/10 backdrop-blur-lg border border-gray-200/50 dark:border-white/10 rounded-2xl p-6 transition-all duration-300 hover:scale-105 hover:shadow-[0_0_40px_rgba(14,165,233,0.35)] hover:border-sky-500/50 hover:bg-white/90 dark:hover:bg-white/15">
                  <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center gap-1">
                      {Array.from({ length: 5 }, () => (
                        <svg class="w-4 h-4 text-yellow-400 fill-current" viewBox="0 0 24 24">
                          <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                        </svg>
                      ))}
                    </div>
                    <div class="text-sm font-medium text-text-light-primary dark:text-text-dark-primary">{review.customerName}</div>
                  </div>
                  <blockquote class="text-text-light-primary dark:text-text-dark-primary text-lg leading-relaxed mb-6 font-medium">
                    "{review.testimonial}"
                  </blockquote>
                  <div class="flex flex-wrap gap-2">
                    {review.tags.map((tag) => (
                      <span class={`px-3 py-1 text-xs font-medium rounded-full border 
                        ${tag.color === 'blue' ? 'bg-blue-500/10 text-blue-500 border-blue-500/20' : ''}
                        ${tag.color === 'green' ? 'bg-green-500/10 text-green-500 border-green-500/20' : ''}
                        ${tag.color === 'purple' ? 'bg-purple-500/10 text-purple-500 border-purple-500/20' : ''}
                        ${tag.color === 'pink' ? 'bg-pink-500/10 text-pink-500 border-pink-500/20' : ''}
                      `}>
                        {tag.label}
                      </span>
                    ))}
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>

        <!-- Desktop: Multi-card view -->
        <div class="hidden md:block px-16">
          <div id="reviewsContainer" class="flex gap-8 transition-transform duration-500 ease-in-out">
            {reviews.map((review) => (
              <ReviewCard {...review} />
            ))}
          </div>
        </div>
      </div>
    </div>

      <!-- Carousel Navigation -->
      <div class="flex justify-center gap-6 mb-16">
        <button id="prevReview" class="flex items-center justify-center w-12 h-12 bg-white/80 dark:bg-white/10 backdrop-blur-lg border border-gray-200/50 dark:border-white/10 rounded-full text-text-light-primary dark:text-text-dark-primary transition-all duration-300 hover:scale-110 hover:bg-primary-blue/20 hover:border-primary-blue/30" aria-label="Previous review">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <polyline points="15,18 9,12 15,6"/>
          </svg>
        </button>
        <button id="nextReview" class="flex items-center justify-center w-12 h-12 bg-white/80 dark:bg-white/10 backdrop-blur-lg border border-gray-200/50 dark:border-white/10 rounded-full text-text-light-primary dark:text-text-dark-primary transition-all duration-300 hover:scale-110 hover:bg-primary-blue/20 hover:border-primary-blue/30" aria-label="Next review">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <polyline points="9,18 15,12 9,6"/>
          </svg>
        </button>
      </div>

    <!-- Stats Section -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-8 mb-16">
      {stats.map((stat) => (
        <StatsCard {...stat} />
      ))}
    </div>

    <!-- Call to Action -->
    <div class="text-center">
      <Button 
        href="/contact-us" 
        text="Join Our Success Stories" 
        variant="cta" 
        size="lg" 
        arrow={true}
        sparkleTheme='cyan' />
    </div>
  </Container>
</Section>

<style>
  /* Reviews section animations */
  .group {
    transform: translateY(0);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .group:hover {
    transform: translateY(-8px) scale(1.02);
    box-shadow: 0 20px 60px rgba(16, 209, 255, 0.15);
  }

  .group:nth-child(2):hover {
    box-shadow: 0 20px 60px rgba(255, 79, 170, 0.15);
  }

  .group:nth-child(3):hover {
    box-shadow: 0 20px 60px rgba(139, 92, 246, 0.15);
  }

  /* Carousel specific styles */
  #reviewsContainer {
    transition: transform 0.5s ease-in-out;
  }

  .review-card {
    flex-shrink: 0;
  }

  /* Navigation buttons */
  #prevReview, #nextReview {
    backdrop-filter: blur(12px);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
  }

  #prevReview:hover, #nextReview:hover {
    transform: scale(1.1);
    box-shadow: 0 12px 40px rgba(16, 209, 255, 0.2);
  }

  /* Dots indicator */
  .carousel-dot {
    cursor: pointer;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  .carousel-dot:hover {
    transform: scale(1.2);
  }

  /* Star rating animations */
  svg {
    transition: all 0.2s ease;
  }

  .group:hover svg {
    transform: scale(1.1);
    filter: drop-shadow(0 0 8px rgba(255, 193, 7, 0.6));
  }
</style>

<script>
  function initReviewsSection() {
    // Separate carousel functionality for mobile and desktop
    const containerMobile = document.getElementById('reviewsContainerMobile');
    const containerDesktop = document.getElementById('reviewsContainer');
    const prevBtn = document.getElementById('prevReview');
    const nextBtn = document.getElementById('nextReview');

    if (!prevBtn || !nextBtn) return;

    let currentIndexMobile = 0;
    let currentIndexDesktop = 0;
    
    // Mobile carousel (1 card at a time)
    function updateMobileCarousel() {
      if (!containerMobile) return;
      const firstSlide = containerMobile.children[0] as HTMLElement;
      const slideWidth = firstSlide?.offsetWidth || 0;
      const translateX = -currentIndexMobile * slideWidth;
      containerMobile.style.transform = `translateX(${translateX}px)`;
    }

    // Desktop carousel (3 cards at a time) 
    function updateDesktopCarousel() {
      if (!containerDesktop) return;
      const card = containerDesktop.children[0] as HTMLElement;
      const cardWidth = card ? card.offsetWidth + 32 : 0; // card width + margin
      const translateX = -currentIndexDesktop * cardWidth;
      containerDesktop.style.transform = `translateX(${translateX}px)`;
    }

    function nextSlide() {
      const isMobile = window.innerWidth < 768;
      
      if (isMobile && containerMobile) {
        const totalCards = containerMobile.children.length;
        currentIndexMobile = (currentIndexMobile + 1) % totalCards;
        updateMobileCarousel();
      } else if (containerDesktop) {
        const totalCards = containerDesktop.children.length;
        const maxIndex = Math.max(0, totalCards - 3); // Show 3 cards on desktop
        currentIndexDesktop = currentIndexDesktop >= maxIndex ? 0 : currentIndexDesktop + 1;
        updateDesktopCarousel();
      }
    }

    function prevSlide() {
      const isMobile = window.innerWidth < 768;
      
      if (isMobile && containerMobile) {
        const totalCards = containerMobile.children.length;
        currentIndexMobile = currentIndexMobile === 0 ? totalCards - 1 : currentIndexMobile - 1;
        updateMobileCarousel();
      } else if (containerDesktop) {
        const totalCards = containerDesktop.children.length;
        const maxIndex = Math.max(0, totalCards - 3);
        currentIndexDesktop = currentIndexDesktop <= 0 ? maxIndex : currentIndexDesktop - 1;
        updateDesktopCarousel();
      }
    }

    function updateCarousel() {
      const isMobile = window.innerWidth < 768;
      if (isMobile) {
        updateMobileCarousel();
      } else {
        updateDesktopCarousel();
      }
    }

    // Event listeners
    nextBtn.addEventListener('click', nextSlide);
    prevBtn.addEventListener('click', prevSlide);

    // Initialize
    updateCarousel();

    // Handle resize
    window.addEventListener('resize', () => {
      updateCarousel();
    });

    // Track carousel interactions (if PostHog is available)
    if (typeof posthog !== 'undefined') {
      nextBtn.addEventListener('click', () => {
        posthog.capture('reviews_carousel_next', {
          current_index: window.innerWidth < 768 ? currentIndexMobile : currentIndexDesktop,
          interaction_type: 'button_click'
        });
      });

      prevBtn.addEventListener('click', () => {
        posthog.capture('reviews_carousel_prev', {
          current_index: window.innerWidth < 768 ? currentIndexMobile : currentIndexDesktop,
          interaction_type: 'button_click'
        });
      });
    }
  }

  // Initialize when DOM is loaded
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initReviewsSection);
  } else {
    initReviewsSection();
  }
</script>