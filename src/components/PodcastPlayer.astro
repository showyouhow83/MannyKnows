---
// Premium Podcast Player Component
export interface Episode {
  id: string;
  title: string;
  description: string;
  mediaType: 'youtube' | 'audio' | 'video';
  mediaUrl: string;
  duration: string;
  category: string;
  season?: number;
  episode?: number;
  thumbnail?: string;
  publishDate: string;
}

const episodes: Episode[] = [
  {
    id: '1',
    title: 'The Future of AI in Business',
    description: 'Exploring how artificial intelligence is revolutionizing modern business practices and what it means for entrepreneurs.',
    mediaType: 'youtube',
    mediaUrl: 'https://www.youtube.com/watch?v=dQw4w9WgXcQ',
    duration: '24:15',
    category: 'AI & Technology',
    season: 1,
    episode: 12,
    thumbnail: 'https://images.unsplash.com/photo-1677442136019-21780ecad995?w=400&h=300&fit=crop&crop=center',
    publishDate: '2024-01-15'
  },
  {
    id: '2',
    title: 'Building Scalable E-commerce Platforms',
    description: 'A deep dive into modern e-commerce architecture and the tools that make scaling possible.',
    mediaType: 'audio',
    mediaUrl: 'https://www.soundjay.com/misc/sounds/bell-ringing-05.wav',
    duration: '31:42',
    category: 'E-commerce',
    season: 1,
    episode: 11,
    publishDate: '2024-01-08'
  },
  {
    id: '3',
    title: 'Customer Experience Revolution',
    description: 'How to create unforgettable customer experiences that drive loyalty and growth.',
    mediaType: 'video',
    mediaUrl: '/video/episode-3.mp4',
    duration: '28:33',
    category: 'Customer Success',
    season: 1,
    episode: 10,
    publishDate: '2024-01-01'
  },
  {
    id: '4',
    title: 'Data-Driven Marketing Strategies',
    description: 'Leveraging analytics and AI to create marketing campaigns that actually convert.',
    mediaType: 'youtube',
    mediaUrl: 'https://www.youtube.com/watch?v=dQw4w9WgXcQ',
    duration: '22:18',
    category: 'Marketing',
    season: 1,
    episode: 9,
    publishDate: '2023-12-25'
  },
  {
    id: '5',
    title: 'Automation for Small Business',
    description: 'Simple automation tools and strategies that can save time and increase efficiency.',
    mediaType: 'audio',
    mediaUrl: 'https://www.soundjay.com/misc/sounds/bell-ringing-05.wav',
    duration: '19:45',
    category: 'Automation',
    season: 1,
    episode: 8,
    publishDate: '2023-12-18'
  },
  {
    id: '6',
    title: 'The Psychology of User Interface',
    description: 'Understanding how design psychology influences user behavior and conversion rates.',
    mediaType: 'video',
    mediaUrl: '/video/episode-6.mp4',
    duration: '26:12',
    category: 'Design & UX',
    season: 1,
    episode: 7,
    publishDate: '2023-12-11'
  },
  {
    id: '7',
    title: 'Digital Transformation Roadmap',
    description: 'A comprehensive guide to planning and executing digital transformation initiatives that deliver real business value.',
    mediaType: 'youtube',
    mediaUrl: 'https://www.youtube.com/watch?v=dQw4w9WgXcQ',
    duration: '35:27',
    category: 'Strategy',
    season: 1,
    episode: 6,
    thumbnail: 'https://images.unsplash.com/photo-1551288049-bebda4e38f71?w=400&h=300&fit=crop&crop=center',
    publishDate: '2023-12-04'
  }
];

const currentEpisode = episodes[0];
---

<div id="premium-podcast-player" class="w-full">
  <!-- Main Player Container - No Background/Shadow -->
  <div class="transition-all duration-500 w-full">
    
    <!-- Player Header -->
    <div class="px-4 py-3 border-b border-gray-200/30 dark:border-white/10">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <div class="w-6 h-6 bg-purple-100 dark:bg-purple-900/30 rounded-lg flex items-center justify-center">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-purple-600 dark:text-purple-400">
              <circle cx="12" cy="12" r="2"/>
              <path d="M19.07 4.93a10 10 0 0 1 0 14.14"/>
              <path d="M16.24 7.76a6 6 0 0 1 0 8.49"/>
              <path d="M4.93 19.07a10 10 0 0 1 0-14.14"/>
              <path d="M7.76 16.24a6 6 0 0 1 0-8.49"/>
            </svg>
          </div>
          <h3 class="apple-gradient-text text-2xl font-bold text-gray-800 dark:text-white transition-colors duration-300" data-colorful-title>
            Podcast
          </h3>
        </div>
      </div>
    </div>

    <!-- Current Episode Info -->
    <div class="px-4 py-4">
      <div class="flex gap-4">
        <!-- Episode Artwork -->
        <div class="relative group">
          <div class="w-16 h-16 rounded-xl overflow-hidden bg-gradient-to-br from-gray-200 to-gray-300 dark:from-gray-700 dark:to-gray-800 flex items-center justify-center shadow-lg ring-1 ring-white/20">
            {currentEpisode.thumbnail ? (
              <img 
                src={currentEpisode.thumbnail} 
                alt={currentEpisode.title}
                class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"
                loading="lazy"
              />
            ) : (
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="text-gray-500 dark:text-gray-400 group-hover:text-primary-blue transition-colors duration-300">
                <path d="M9 18V5l12-2v13"/>
                <circle cx="6" cy="18" r="3"/>
                <circle cx="18" cy="16" r="3"/>
              </svg>
            )}
          </div>
          <!-- Media Type Indicator -->
          <div class="absolute -top-1 -right-1 w-5 h-5 rounded-full bg-white/95 dark:bg-gray-900/95 border-2 border-white dark:border-gray-900 flex items-center justify-center shadow-lg">
            {currentEpisode.mediaType === 'youtube' && (
              <svg width="12" height="12" viewBox="0 0 24 24" fill="#FF0000">
                <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
              </svg>
            )}
            {currentEpisode.mediaType === 'audio' && (
              <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-green-500">
                <path d="M9 18V5l12-2v13"/>
                <circle cx="6" cy="18" r="3"/>
                <circle cx="18" cy="16" r="3"/>
              </svg>
            )}
            {currentEpisode.mediaType === 'video' && (
              <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-purple-500">
                <polygon points="23 7 16 12 23 17 23 7"/>
                <rect x="1" y="5" width="15" height="14" rx="2" ry="2"/>
              </svg>
            )}
          </div>
        </div>

        <!-- Episode Details -->
        <div class="flex-1 min-w-0">
          <div class="flex items-start justify-between mb-2">
            <div class="flex-1 min-w-0 pr-3">
              <h4 class="text-sm font-semibold text-gray-900 dark:text-white truncate leading-tight mb-1">
                {currentEpisode.title}
              </h4>
              <p class="text-xs text-gray-600 dark:text-gray-400 line-clamp-2 leading-relaxed">
                {currentEpisode.description}
              </p>
            </div>
            <div class="flex-shrink-0 text-right">
              <span class="inline-block px-2 py-1 text-xs font-medium rounded-lg bg-gradient-to-r from-primary-blue/20 to-primary-pink/20 text-primary-blue dark:text-primary-pink border border-primary-blue/30 dark:border-primary-pink/30">
                {currentEpisode.category}
              </span>
              <div class="text-xs text-gray-500 dark:text-gray-400 mt-1 font-mono">
                {currentEpisode.duration}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Player Controls -->
    <div class="px-4 py-3">
      <!-- Progress Bar -->
      <div class="mb-3">
        <div id="progress-container" class="relative w-full h-1.5 bg-gray-200/70 dark:bg-gray-700/70 rounded-full overflow-hidden cursor-pointer group">
          <div 
            id="progress-bar" 
            class="h-full bg-gradient-to-r from-primary-blue to-primary-pink transition-all duration-150 rounded-full"
            style="width: 0%"
          ></div>
          <div 
            id="progress-handle"
            class="absolute top-1/2 -translate-y-1/2 w-3 h-3 bg-white dark:bg-gray-100 rounded-full shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 cursor-grab border-2 border-gray-300 dark:border-gray-600"
            style="left: 0%"
          ></div>
        </div>
        <div class="flex justify-between text-xs text-gray-500 dark:text-gray-400 mt-1">
          <span id="current-time">0:00</span>
          <span id="total-time">{currentEpisode.duration}</span>
        </div>
      </div>

      <!-- Control Buttons -->
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-2">
          <!-- Previous Button -->
          <button 
            id="prev-btn"
            class="p-2 rounded-xl bg-gray-100/60 dark:bg-white/10 hover:bg-gray-200/80 dark:hover:bg-white/20 transition-all duration-300 group"
            aria-label="Previous episode"
          >
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-gray-600 dark:text-gray-300 group-hover:text-gray-800 dark:group-hover:text-white transition-colors duration-300">
              <polygon points="19 20 9 12 19 4 19 20"/>
              <line x1="5" x2="5" y1="19" y2="5"/>
            </svg>
          </button>

          <!-- Play/Pause Button -->
          <button 
            id="play-pause-btn"
            class="relative p-3 rounded-full bg-gradient-to-r from-primary-blue to-primary-pink hover:from-primary-blue/90 hover:to-primary-pink/90 transition-all duration-300 transform hover:scale-105 active:scale-95 shadow-lg hover:shadow-xl"
            aria-label="Play/Pause"
          >
            <svg id="play-icon" width="16" height="16" viewBox="0 0 24 24" fill="white" class="ml-0.5">
              <polygon points="5 3 19 12 5 21 5 3"/>
            </svg>
            <svg id="pause-icon" width="16" height="16" viewBox="0 0 24 24" fill="white" class="hidden">
              <rect x="6" y="4" width="4" height="16"/>
              <rect x="14" y="4" width="4" height="16"/>
            </svg>
          </button>

          <!-- Next Button -->
          <button 
            id="next-btn"
            class="p-2 rounded-xl bg-gray-100/60 dark:bg-white/10 hover:bg-gray-200/80 dark:hover:bg-white/20 transition-all duration-300 group"
            aria-label="Next episode"
          >
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-gray-600 dark:text-gray-300 group-hover:text-gray-800 dark:group-hover:text-white transition-colors duration-300">
              <polygon points="5 4 15 12 5 20 5 4"/>
              <line x1="19" x2="19" y1="5" y2="19"/>
            </svg>
          </button>
        </div>

        <div class="flex items-center gap-2">
          <!-- Volume Control -->
          <div class="flex items-center gap-2">
            <button 
              id="volume-btn"
              class="p-1.5 rounded-xl bg-gray-100/60 dark:bg-white/10 hover:bg-gray-200/80 dark:hover:bg-white/20 transition-all duration-300 group"
              aria-label="Toggle mute"
            >
              <svg id="volume-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-gray-600 dark:text-gray-300 group-hover:text-gray-800 dark:group-hover:text-white transition-colors duration-300">
                <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
                <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"/>
              </svg>
            </button>
            <div id="volume-container" class="w-12 h-1.5 bg-gray-200/70 dark:bg-gray-700/70 rounded-full overflow-hidden cursor-pointer group">
              <div id="volume-bar" class="h-full bg-gradient-to-r from-primary-blue to-primary-pink rounded-full transition-all duration-150" style="width: 70%"></div>
            </div>
          </div>

          <!-- External Link -->
          <button 
            id="external-link-btn"
            class="p-1.5 rounded-xl bg-gray-100/60 dark:bg-white/10 hover:bg-gray-200/80 dark:hover:bg-white/20 transition-all duration-300 group"
            aria-label="Open in external player"
          >
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-gray-600 dark:text-gray-300 group-hover:text-gray-800 dark:group-hover:text-white transition-colors duration-300">
              <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
              <polyline points="15,3 21,3 21,9"/>
              <line x1="10" x2="21" y1="14" y2="3"/>
            </svg>
          </button>
        </div>
      </div>
    </div>

    <!-- Episode Library - Always Visible -->
    <div id="episode-library" class="border-t border-gray-200/30 dark:border-white/10">
      <div class="px-4 py-3">
        <h4 class="text-sm font-semibold text-gray-900 dark:text-white mb-3">Episode Library</h4>
        
        <!-- Episodes List -->
        <div class="space-y-2 h-80 md:h-96 overflow-y-auto scrollbar-hide">
          {episodes.map((episode, index) => (
            <div 
              class={`episode-item flex gap-3 p-2.5 rounded-lg bg-gray-50/60 dark:bg-white/5 hover:bg-gray-100/80 dark:hover:bg-white/10 border border-transparent hover:border-gray-200/50 dark:hover:border-white/10 transition-all duration-300 cursor-pointer group ${
                index >= 2 ? 'hidden md:flex' : ''
              }`}
              data-episode-id={episode.id}
              data-media-url={episode.mediaUrl}
              data-media-type={episode.mediaType}
            >
              <!-- Episode Thumbnail -->
              <div class="relative flex-shrink-0">
                <div class="w-10 h-10 rounded-lg overflow-hidden bg-gradient-to-br from-gray-200 to-gray-300 dark:from-gray-700 dark:to-gray-800 flex items-center justify-center shadow-sm">
                  {episode.thumbnail ? (
                    <img 
                      src={episode.thumbnail} 
                      alt={episode.title}
                      class="w-full h-full object-cover"
                      loading="lazy"
                    />
                  ) : (
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="text-gray-500 dark:text-gray-400">
                      <path d="M9 18V5l12-2v13"/>
                      <circle cx="6" cy="18" r="3"/>
                      <circle cx="18" cy="16" r="3"/>
                    </svg>
                  )}
                </div>
                <!-- Media Type Indicator -->
                <div class="absolute -top-1 -right-1 w-4 h-4 rounded-full bg-white/90 dark:bg-gray-900/90 border border-white dark:border-gray-900 flex items-center justify-center">
                  {episode.mediaType === 'youtube' && (
                    <svg width="8" height="8" viewBox="0 0 24 24" fill="#FF0000">
                      <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
                    </svg>
                  )}
                  {episode.mediaType === 'audio' && (
                    <svg width="6" height="6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" class="text-green-500">
                      <path d="M9 18V5l12-2v13"/>
                      <circle cx="6" cy="18" r="3"/>
                      <circle cx="18" cy="16" r="3"/>
                    </svg>
                  )}
                  {episode.mediaType === 'video' && (
                    <svg width="6" height="6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" class="text-purple-500">
                      <polygon points="23 7 16 12 23 17 23 7"/>
                      <rect x="1" y="5" width="15" height="14" rx="2" ry="2"/>
                    </svg>
                  )}
                </div>
              </div>

              <!-- Episode Info -->
              <div class="flex-1 min-w-0">
                <div class="flex items-start justify-between">
                  <div class="flex-1 min-w-0 pr-2">
                    <h5 class="text-xs font-medium text-gray-900 dark:text-white truncate leading-tight group-hover:text-primary-blue dark:group-hover:text-primary-pink transition-colors duration-300">
                      {episode.title}
                    </h5>
                    <p class="text-xs text-gray-600 dark:text-gray-400 mt-0.5 line-clamp-1">
                      {episode.description}
                    </p>
                  </div>
                  <div class="flex-shrink-0 text-right">
                    <div class="text-xs text-gray-500 dark:text-gray-400 font-mono">
                      {episode.duration}
                    </div>
                  </div>
                </div>
                
                <!-- Category Badge -->
                <div class="mt-1.5">
                  <span class={`inline-block px-1.5 py-0.5 text-xs font-medium rounded-md ${
                    episode.category === 'AI & Technology' ? 'bg-blue-500/20 text-blue-400 border border-blue-500/30' :
                    episode.category === 'E-commerce' ? 'bg-green-500/20 text-green-400 border border-green-500/30' :
                    episode.category === 'Customer Success' ? 'bg-purple-500/20 text-purple-400 border border-purple-500/30' :
                    episode.category === 'Marketing' ? 'bg-pink-500/20 text-pink-400 border border-pink-500/30' :
                    episode.category === 'Automation' ? 'bg-yellow-500/20 text-yellow-400 border border-yellow-500/30' :
                    episode.category === 'Design & UX' ? 'bg-indigo-500/20 text-indigo-400 border border-indigo-500/30' :
                    episode.category === 'Strategy' ? 'bg-orange-500/20 text-orange-400 border border-orange-500/30' :
                    'bg-gray-500/20 text-gray-400 border border-gray-500/30'
                  }`}>
                    {episode.category}
                  </span>
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .line-clamp-1 {
    display: -webkit-box;
    -webkit-line-clamp: 1;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
  
  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }

  /* Smooth expansion animation */
  #episode-library.expanded {
    max-height: 420px;
    opacity: 1;
  }

  /* Enhanced hover effects */
  .episode-item {
    transform: translateZ(0);
    backface-visibility: hidden;
  }
  
  .episode-item:hover {
    transform: translateY(-1px) translateZ(0);
    box-shadow: 0 8px 25px -8px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(255, 255, 255, 0.05);
  }

  /* Custom progress bar styling */
  #progress-bar {
    background: linear-gradient(90deg, #10d1ff, #ff4faa);
    background-size: 200% 100%;
    animation: gradient-pulse 4s ease-in-out infinite;
    position: relative;
  }

  #progress-bar::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    animation: shimmer-progress 2s infinite;
  }

  @keyframes gradient-pulse {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
  }

  @keyframes shimmer-progress {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
  }

  /* Loading state animations */
  .loading {
    opacity: 0.7;
    pointer-events: none;
    position: relative;
  }

  .loading::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    animation: shimmer 1.5s infinite;
    z-index: 10;
    border-radius: inherit;
  }

  @keyframes shimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
  }

  /* Subtle pulse animation for loading buttons */
  .animate-pulse-subtle {
    animation: pulse-subtle 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
  }

  @keyframes pulse-subtle {
    0%, 100% {
      opacity: 1;
    }
    50% {
      opacity: 0.8;
    }
  }

  /* Loading spinner inside play button */
  .play-btn-loading {
    background: linear-gradient(45deg, rgba(16, 209, 255, 0.8), rgba(255, 79, 170, 0.8));
    animation: pulse-gradient 1.5s ease-in-out infinite;
  }

  @keyframes pulse-gradient {
    0%, 100% {
      background: linear-gradient(45deg, rgba(16, 209, 255, 0.8), rgba(255, 79, 170, 0.8));
    }
    50% {
      background: linear-gradient(45deg, rgba(16, 209, 255, 1), rgba(255, 79, 170, 1));
    }
  }

  /* Button press animations */
  #play-pause-btn:active {
    transform: scale(0.95);
  }

  /* Smooth icon transitions */
  #library-icon {
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  /* Glass morphism effects */
  .backdrop-blur-sm {
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
  }

  /* Enhanced gradients */
  .episode-item:hover .bg-gradient-to-br {
    background: linear-gradient(135deg, rgba(16, 209, 255, 0.1), rgba(255, 79, 170, 0.1));
  }

  /* Micro-interactions */
  button {
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  }

  button:hover {
    transform: translateY(-1px);
  }

  button:active {
    transform: translateY(0);
  }

  /* Selection highlighting */
  .episode-item.selected {
    background: linear-gradient(135deg, rgba(16, 209, 255, 0.15), rgba(255, 79, 170, 0.15));
    border-color: rgba(16, 209, 255, 0.3);
    box-shadow: 0 0 20px rgba(16, 209, 255, 0.2);
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    class PodcastPlayer {
      constructor() {
        this.isPlaying = false;
        this.currentAudio = null;
        this.currentEpisodeIndex = 0;
        this.episodes = [];
        this.init();
      }

      init() {
        this.extractEpisodeData();
        this.bindEvents();
        this.initializeFirstEpisode();
      }

      extractEpisodeData() {
        const episodeItems = document.querySelectorAll('.episode-item');
        this.episodes = Array.from(episodeItems).map((item, index) => ({
          id: item.dataset.episodeId,
          mediaUrl: item.dataset.mediaUrl,
          mediaType: item.dataset.mediaType,
          element: item,
          index: index
        }));
      }

      initializeFirstEpisode() {
        const firstEpisode = document.querySelector('.episode-item');
        if (firstEpisode) {
          firstEpisode.classList.add('selected');
        }
      }

      bindEvents() {
        const playPauseBtn = document.getElementById('play-pause-btn');
        if (playPauseBtn) {
          playPauseBtn.addEventListener('click', () => this.togglePlayPause());
        }

        const episodeItems = document.querySelectorAll('.episode-item');
        episodeItems.forEach(item => {
          item.addEventListener('click', (e) => this.selectEpisode(e.currentTarget));
        });

        const prevBtn = document.getElementById('prev-btn');
        if (prevBtn) {
          prevBtn.addEventListener('click', () => this.previousEpisode());
        }

        const nextBtn = document.getElementById('next-btn');
        if (nextBtn) {
          nextBtn.addEventListener('click', () => this.nextEpisode());
        }

        const externalBtn = document.getElementById('external-link-btn');
        if (externalBtn) {
          externalBtn.addEventListener('click', () => this.openExternal());
        }
      }

      async togglePlayPause() {
        const playIcon = document.getElementById('play-icon');
        const pauseIcon = document.getElementById('pause-icon');
        
        if (!this.currentAudio) {
          await this.loadCurrentEpisode();
          return;
        }
        
        if (this.isPlaying) {
          this.currentAudio.pause();
          this.isPlaying = false;
          if (playIcon) playIcon.classList.remove('hidden');
          if (pauseIcon) pauseIcon.classList.add('hidden');
        } else {
          this.currentAudio.play();
          this.isPlaying = true;
          if (playIcon) playIcon.classList.add('hidden');
          if (pauseIcon) pauseIcon.classList.remove('hidden');
        }
      }

      async loadCurrentEpisode() {
        const currentEpisode = this.episodes[this.currentEpisodeIndex];
        if (!currentEpisode) return;

        try {
          if (this.currentAudio) {
            this.currentAudio.pause();
          }

          if (currentEpisode.mediaType === 'audio') {
            this.currentAudio = new Audio(currentEpisode.mediaUrl);
            this.setupAudioEvents();
            this.currentAudio.play();
            this.isPlaying = true;
            this.updatePlayButton();
          } else if (currentEpisode.mediaType === 'youtube') {
            window.open(currentEpisode.mediaUrl, '_blank');
            this.isPlaying = false;
            this.updatePlayButton();
          }
        } catch (error) {
          console.warn('Media loading failed:', error);
        }
      }

      setupAudioEvents() {
        if (!this.currentAudio) return;
        
        this.currentAudio.addEventListener('timeupdate', () => {
          if (this.currentAudio.duration) {
            const progress = (this.currentAudio.currentTime / this.currentAudio.duration) * 100;
            this.updateProgress(progress);
            this.updateTimeDisplay();
          }
        });
        
        this.currentAudio.addEventListener('ended', () => {
          this.nextEpisode();
        });
      }

      updatePlayButton() {
        const playIcon = document.getElementById('play-icon');
        const pauseIcon = document.getElementById('pause-icon');
        
        if (this.isPlaying) {
          if (playIcon) playIcon.classList.add('hidden');
          if (pauseIcon) pauseIcon.classList.remove('hidden');
        } else {
          if (playIcon) playIcon.classList.remove('hidden');
          if (pauseIcon) pauseIcon.classList.add('hidden');
        }
      }

      updateProgress(percentage) {
        const progressBar = document.getElementById('progress-bar');
        if (progressBar) {
          progressBar.style.width = percentage + '%';
        }
      }

      updateTimeDisplay() {
        if (!this.currentAudio) return;
        
        const currentTime = document.getElementById('current-time');
        const totalTime = document.getElementById('total-time');
        
        if (currentTime) {
          currentTime.textContent = this.formatTime(this.currentAudio.currentTime);
        }
        if (totalTime && this.currentAudio.duration) {
          totalTime.textContent = this.formatTime(this.currentAudio.duration);
        }
      }

      formatTime(seconds) {
        const mins = Math.floor(seconds / 60);
        const secs = Math.floor(seconds % 60);
        return mins + ':' + secs.toString().padStart(2, '0');
      }

      selectEpisode(episodeElement) {
        this.episodes.forEach(ep => ep.element.classList.remove('selected'));
        episodeElement.classList.add('selected');
        this.currentEpisodeIndex = this.episodes.findIndex(ep => ep.element === episodeElement);
        this.loadCurrentEpisode();
      }

      previousEpisode() {
        if (this.currentEpisodeIndex > 0) {
          this.currentEpisodeIndex--;
          this.selectEpisode(this.episodes[this.currentEpisodeIndex].element);
        }
      }

      nextEpisode() {
        if (this.currentEpisodeIndex < this.episodes.length - 1) {
          this.currentEpisodeIndex++;
          this.selectEpisode(this.episodes[this.currentEpisodeIndex].element);
        }
      }

      openExternal() {
        const currentEpisode = this.episodes[this.currentEpisodeIndex];
        if (currentEpisode && currentEpisode.mediaUrl) {
          window.open(currentEpisode.mediaUrl, '_blank');
        }
      }
    }

    window.podcastPlayer = new PodcastPlayer();
  });
</script>
